function mbBgndGallery(e){return $.mbBgndGallery.buildGallery(e)}function EasyImage(e){var t=this;t.name=ko.observable(e[0]||""),t.url=ko.observable(e[1]||"")}function Design(e){var t=this;t.id=ko.observable(e._id?e._id:""),t.name=ko.observable(e.name?e.name:"New Design"),t.css=ko.observable(e.css?e.css:""),t.menu_css=ko.observable(e.menu_css?e.menu_css:""),t.template_location=ko.observable(e.template_location?e.template_location:""),t.fonts=ko.observable(e.fonts?e.fonts:""),t.global_images=ko.observableArray([]),t.carousel=ko.observableArray([]),t.example_image=ko.observable(),t.imgs={},_.each(e.global_images,function(e){var n=new GlobalImage(e);n.design_id(t.id()),e.carousel?t.carousel.push(n):(t.global_images.push(n),n.addImage()),void 0===t.imgs[n.name()]&&""!=n.name()&&(t.imgs[n.name()]=n.url)}),t.new_design=ko.computed(function(){return""!=t.id()}),t.addImage=function(){var e=new GlobalImage({design_id:t.id(),parent:t,parent_id:t.id});t.global_images.push(e),e.get_id()},t.addExampleImage=function(e){if(e){var n=new GlobalImage(e);n.design_id(t.id())}else var n=new GlobalImage({design_id:t.id(),parent:t,parent_id:t.id,example_image:!0});t.example_image(n)},t.addExampleImage(e.example_image),t.addCarousel=function(){var e=new GlobalImage({design_id:t.id(),carousel:!0,parent:t,parent_id:t.id});t.carousel.push(e)},t.destroyImage=function(e){bootbox.dialog({message:'Are you sure you want to remove this image "'+e.name()+'"?',title:"Remove Image",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){$.ajax({type:"POST",url:"/app/design/destroy_image",data:{image_id:e.id()},success:function(){console.log("image destroyed"),t.global_images.remove(e),t.carousel.remove(e)},dataType:"json"})}}}})},t.initialized=!1,0==t.initialized&&(t.addCarousel(),t.initialized=!0)}function GlobalImage(e){var t=this;t.progressValue=ko.observable(1),t.id=ko.observable(""),t.name=ko.observable(e.name||""),t.css=ko.observable(e.css||""),t.description=ko.observable(""),t.url=ko.observable("/loader.gif"),t.custom=ko.observable(!1),t.fresh=ko.observable(!0),t.customizable=ko.observable(),t.css=ko.observable(e.css?e.css:""),t.template_location=ko.observable(e.template_location?e.template_location:""),t.example_image=ko.observable(e.example_image?e.example_image:""),t.failed=ko.observable(!1),t.design_id=ko.observable(e.design_id),t.completed=ko.observable(!1),t.default_image=ko.observable(e.default_image?e.default_image:!1),t.defaultImage=ko.observable(),t.selectedImage=ko.observable(!1),t.parent_id=e.parent_id,t.parent=e.parent,t.carousel=ko.observable(e.carousel?e.carousel:""),t.global_images=ko.observableArray([]),t.dropdowning=ko.observable(!1),t.drop=function(){t.dropdowning(!0)},e&&(t.id(e._id),t.name(e.name),t.css(e.css),t.description(e.description),t.customizable(e.customizable),e.custom&&t.custom(e.custom),e.url&&(t.completed(!0),t.default_image(e.default_image),t.url=ko.observable(e.url),t.fresh(!1)),_.each(e.global_images,function(e){var n=new GlobalImage(e);console.log("new global image: "+n.id()),n.design_id(t.design_id()),n.parent=t,n.parent_id=t.id,n.default_image()&&(t.defaultImage(n),t.url(n.url()),t.css(n.css())),t.global_images.push(n)})),t.background=ko.computed(function(){return"url("+t.url()+")"}),t.setDefault=function(e){t.dropdowning(!1),t.url(e.url()),t.defaultImage(e)},t.update_info=function(e){t.url(e.url),t.completed(!0),t.custom(e.custom),t.id(e.image_id?e.image_id:e.id)},t.destroyImage=function(e){bootbox.dialog({message:'Are you sure you want to remove this image "'+e.name()+'"?',title:"Remove Image",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){$.ajax({type:"POST",url:"/app/design/destroy_sub_image",data:{image_id:e.id()},success:function(){console.log("image destroyed"),t.global_images.remove(e)},dataType:"json"})}}}})},t.get_id=function(){$.ajax({type:"POST",url:"/app/design/create_image",data:{design_id:t.design_id()},success:function(e){t.update_info(e),t.addImage()},dataType:"json"})},t.addImage=function(){var e=new GlobalImage({parent_id:t.id,name:t.name(),design_id:t.design_id(),parent:t});0==t.global_images().length&&(e.default_image=!0),t.global_images.push(e)},t.apply=function(){},t.computedImageUpload=ko.computed(function(){return"/loader.gif"!=t.url()?"Replace Image":"Upload Image"})}function Page(e){e?null:e={};var t=this;t.id=e.id,t.html=ko.observable(e.html?e.html:copyDefaultHash(default_web_language_hash)),t.name=ko.observable(e.name?e.name:copyDefaultHash(default_page_language_hash)),t.remove=function(e){bootbox.dialog({message:"Remove page?",title:"Remove Page",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){e.pages.remove(t)}}}})}}function LogoSettings(e){e?null:e={};var t=this;t.logo_as_image=ko.observable(e.logo_as_image?e.logo_as_image:!1),t.image_height=ko.observable(null!=e.image_height?e.image_height:50),t.border_color=ko.observable(e.border_color?e.border_color:"000000"),t.border_radius=ko.observable(null!=e.border_radius?e.border_radius:3),t.border_size=ko.observable(null!=e.border_size?e.border_size:2),t.showLogo=ko.computed({read:function(){return t.logo_as_image()?$(window).width()<600?!1:!0:!1},deferEvaluation:!0})}function Day(e,t){var n=this;n.name=e,n.closed=ko.observable(!0),n.open_1=ko.observable(t.open_1),n.close_1=ko.observable(t.close_1),n.open_2=ko.observable(t.open_2),n.close_2=ko.observable(t.close_2),n.lName=ko.computed({read:function(){return viewmodel.lang?days_tr[n.name][viewmodel.lang()]:""},deferEvaluation:!0}),n.times=["00:00","00:30","1:00","1:30","2:00","2:30","3:00","3:30","4:00","4:30","5:00","5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"],0==t.closed&&n.closed(t.closed),n.toggleClosed=function(){n.closed(!n.closed())},n.labelText=ko.computed({read:function(){return viewmodel.lang?n.closed()?opened_tr.closed[viewmodel.lang()]:opened_tr.open[viewmodel.lang()]:n.buttonText()},deferEvaluation:!0}),n.buttonText=ko.computed(function(){return n.closed()?"Closed":"Open"}),n.validateOpen_1=ko.observable(!0),n.open_1.subscribe(function(e){n.validateOpen_1(null==e?!0:!1)}),n.validateClose_1=ko.observable(!0),n.close_1.subscribe(function(e){n.validateClose_1(null==e?!0:!1)}),n.open_1.valueHasMutated(),n.close_1.valueHasMutated()}function Restaurant(e){console.log("New Restaurant: "+e.name);var t=this;t.languages=ko.observableArray(e.languages?e.languages:["en"]),t.available_languages=ko.observableArray(_.map(_.pairs(fullLanguageName),function(e){return new Language(e[1],e[0])})),t.name=ko.observable(e.name?e.name:""),t.lat=ko.observable(e.lat?e.lat:""),t.lon=ko.observable(e.lon?e.lon:""),t.website=ko.observable(e.website?e.website:""),t.email=ko.observable(e.email?e.email:""),t.subdomain=ko.observable(e.subdomain?e.subdomain:""),t.facebook=ko.observable(e.facebook?e.facebook:""),t.foursquare=ko.observable(e.foursquare?e.foursquare:""),t.instagram=ko.observable(e.instagram?e.instagram:""),t.twitter=ko.observable(e.twitter?e.twitter:""),t.phone=ko.observable(e.phone?e.phone:""),t.address_line_1=ko.observable(e.address_line_1?e.address_line_1:""),t.address_line_2=ko.observable(e.address_line_2?e.address_line_2:""),t.city=ko.observable(e.city?e.city:""),t.province=ko.observable(e.province?e.province:""),t.postal_code=ko.observable(e.postal_code?e.postal_code:""),t.design=ko.observable(void 0===e.design?null:new Design(e.design)),t.id=e._id,t.font_id=e.font_id?e.font_id:"",t.user_id=e.user_id?e.user_id:"",t.logo=ko.observable(new GlobalImage(e.logo?e.logo:{})),t.logo_settings=ko.observable(e.logo_settings?new LogoSettings(e.logo_settings):new LogoSettings),t.about_text=ko.observable(e.about_text?e.about_text:copyDefaultHash(default_web_language_hash)),t.pages=ko.observableArray([]),e.pages&&t.pages(_.map(e.pages,function(e){return new Page(e)})),t.hours=ko.observableArray([]);var n={monday:{open_1:null,close_1:null,open_2:null,close_2:null},tuesday:{open_1:null,close_1:null,open_2:null,close_2:null},wednesday:{open_1:null,close_1:null,open_2:null,close_2:null},thusrday:{open_1:null,close_1:null,open_2:null,close_2:null},friday:{open_1:null,close_1:null,open_2:null,close_2:null},saturday:{open_1:null,close_1:null,open_2:null,close_2:null},sunday:{open_1:null,close_1:null,open_2:null,close_2:null}};e.hours&&(n=e.hours),t.available_hours=ko.observable(!1),_.each(_.pairs(n),function(e){0==e[1].closed&&t.available_hours(!0);var e=new Day(e[0],e[1]);t.hours.push(e)});var o={0:6,1:0,2:1,3:2,4:3,5:4,6:5};t.areWeOpened=ko.computed(function(){var e=o[(new Date).getDay()],n=t.hours()[e];if(n.closed()||void 0===n.open_1())return!1;var i=n.open_1();if(null==i)return!1;i=i.split(":"),i=new Date(2012,6,1,i[0],i[1]).getTime(),console.log(i);var r=new Date(2012,6,1,(new Date).getHours(),(new Date).getMinutes()).getTime(),a=n.close_1();if(null==a)return!1;if(a=a.split(":"),a=new Date(2012,6,1,a[0],a[1]).getTime(),console.log(a),i>a){var s=new Date(2012,6,1,"23","59").getTime(),l=new Date(2012,6,1,"00","01").getTime();return r>i&&s>r||r>l&&a>r?!0:!1}return r>i&&a>r?!0:!1}),t.areWeOpenedText=ko.computed(function(){return t.areWeOpened()?"open":"closed"}),t.socialVisible=function(e){return ko.computed(function(){return null!=t[e]()&&""!=t[e]()?!0:!1})},t.createNewPageText=ko.computed(function(){return t.pages().length<3?"Create New Page":"Max Pages Reached"}),t.save=function(e){if(t.subdomain.valueHasMutated(),!t.validateSubdomain())return void bootbox.dialog({message:"The subdomain you've chosen is either invalid or unavailable.",title:"Invalid Subdomain",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3"}}});if(!t.validateAddress())return void bootbox.dialog({message:"Please enter your restaurant address so that your users can find you.",title:"Blank Address",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3"}}});if(!t.validatePhone())return void bootbox.dialog({message:"You havent entered a phone number. Please do so that your customers can get in touch with you.",title:"Blank Phone",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3"}}});var n=_.every(t.hours(),function(e){return e.closed()?!0:!e.closed()&&!e.validateOpen_1()&&!e.validateClose_1()});return n?void $.ajax({type:"POST",url:"/app/administration/update_restaurant",data:{restaurant_id:t.id,params:ko.toJSON(t)},success:function(){bootbox.dialog({message:"Your information was saved",title:"Saved!",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3",callback:function(){t.dirty(!1),"function"==typeof e&&e()}}}})},error:function(e,t,n){console.log("There was an error saving the section "+n)},dataType:"json"}):void bootbox.dialog({message:"The hours you entered are incorrect or missing. Look for the one highlighted red.",title:"Invalid Hours",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3"}}})},t.subdomain.extend({rateLimit:700}),t.validateSubdomain=ko.observable(!0),""==t.subdomain()&&t.validateSubdomain(!1),t.validateAddress=ko.computed(function(){return 0==t.address_line_1().length?!1:!0}),t.validatePhone=ko.computed(function(){return 0==t.phone().length?!1:!0}),t.subdomain.subscribe(function(e){""==e&&t.validateSubdomain(!1),$.ajax({type:"POST",url:"/app/administration/validate_subdomain",data:{restaurant_id:t.id,subdomain:e},success:function(e){t.validateSubdomain(e.valid?!0:!1)},error:function(e,n,o){console.log("There was an error saving the section "+o),t.validateSubdomain(!1)},dataType:"json"})}),t.quick_save=function(e){$.ajax({type:"POST",url:"/app/administration/update_restaurant",data:{restaurant_id:t.id,params:ko.toJSON(t)},success:function(){bootbox.dialog({message:"Saved!",title:"Saved!",buttons:{success:{label:"Ok",className:"btn-primary pull-right col-xs-3",callback:function(){"function"==typeof e&&e()}}}})},error:function(e,t,n){console.log("There was an error saving the section "+n)},dataType:"json"})},t.dirty=ko.observable(!1),t.dirtyTrack=ko.computed(function(){t.name(),t.subdomain(),t.address_line_1(),t.phone(),t.city(),t.postal_code(),t.province(),t.email(),t.dirty(!0)}),t.dirty(!1),t.newPage=function(){var e=new Page;return t.pages.push(e),e}}function Section(e,t){var n=this;n.topmodel=t,n.id=ko.observable(),n.position=ko.observable(e.position?e.position:0),e._id?n.id(e._id):editing_mode&&$.ajax({type:"POST",url:"/app/menucrud/create_section",data:{restaurant_id:restaurant_id},success:function(e){console.log("Section Saved."),n.id(e.id)},error:function(e,t,n){console.log("There was an error saving the section "+n)},dataType:"json"}),n.name=ko.observable(e.name),n.dishes=ko.observableArray([]),e.dishes&&(n.dishes=ko.observableArray($.map(e.dishes,function(e){return new Dish(e,n)}))),n.dishes.subscribe(function(){_.each(n.dishes(),function(e,t){e.position(t)})}),n.printJson=function(){console.log(ko.toJSON(n))},n.dom_id=e.dom_id?e.dom_id:"",n.computed_name=ko.computed(function(){var e=currentLangName(n.name);return""==e.reso?""==e.en?"New Section":e.en:e.reso}),n.title_image=ko.computed(function(){return"/app/public/icon@2x.png"},n),n.editing_name=ko.observable(!1),n.edit_name=function(){n.editing_name(!0)},n.remove=function(e){bootbox.dialog({message:localizeMessage(e.name(),"remove_dish"),title:"Remove Dish",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){t.current_dish(null),n.dishes.remove(e)}}}})},n.newDishName=ko.observable(),n.addDish=function(){var e=new Dish({name:copyDefaultHash(default_language_hash),description:copyDefaultHash(default_language_hash)},n);n.dishes.unshift(e),n.topmodel.current_section(null),n.topmodel.current_dish(e)}}function Image(e){var t=this;t.progressValue=ko.observable(1),t.filename=ko.observable(""),t.id=ko.observable(""),t.url=ko.observable("/loader.gif"),t.original=ko.observable("/loader.gif"),t.medium=ko.observable("/loader.gif"),t.completed=ko.observable(!1),t.image_width=ko.observable(0),t.image_height=ko.observable(0),t.coordinates=[],t.failed=ko.observable(!1),e&&(e.local_file||e.url)&&(t.id(e._id),t.url=ko.observable(e.local_file||e.url),t.completed(!0),t.original=ko.observable(e.original),t.medium=ko.observable(e.medium),t.image_width=ko.observable(e.width),t.image_height=ko.observable(e.height)),t.crop=function(){$.ajax({type:"POST",url:image_crop_url,data:{image_id:t.id(),coordinates:t.coordinates},success:function(e){t.update_info(e)},error:function(e,t){console.log(t)},dataType:"json"})},t.update_info=function(e){t.url(e.thumbnailUrl),t.completed(!0),t.id(e.image_id),t.original(e.original),t.image_width=ko.observable(e.width),t.image_height=ko.observable(e.height)}}function Dish(e,t){var n=this;n.name=ko.observable(e.name),n.description=ko.observable(e.description),n.price=ko.observable(e.price),n.topmodel=t,n.position=ko.observable(e.position?e.position:0),n.images=ko.observableArray([]),n.sizeSelectedOptionValue=ko.observable(),n.modalVisible=ko.observable(!1),n.printJson=function(){console.log(ko.toJSON(n))},n.computed_name=ko.computed(function(){var e=currentLangName(n.name);return""==e.reso?""==e.en?"New Dish":e.en:e.reso}),n.id=ko.observable(),e._id?n.id(e._id):editing_mode&&$.ajax({type:"POST",url:"/app/menucrud/create_dish",data:{restaurant_id:restaurant_id},success:function(e){console.log("Section Saved."),n.id(e.id)},error:function(e,t,n){console.log("There was an error saving the section "+n)},dataType:"json"}),e.has_multiple_sizes?(n.sizes=ko.observable(!0),n.sizes_object=ko.observable(new Option(e.sizes,n))):(n.sizes=ko.observable(!1),n.sizes_object=ko.observable(e.sizes?new Option(e.sizes,n):new Option({type:"size",name:copyDefaultHash(default_sizes_hash),individual_options:[{name:copyDefaultHash(default_sizes_hash_small),price:"0.0"},{name:copyDefaultHash(default_sizes_hash_large),price:"0.0"}]},n))),n.sizeSelectedOptionValue=ko.observable(n.sizes_object().individual_options()[0]),n.options=ko.observableArray([]),e.options&&(n.options=ko.observableArray($.map(e.options,function(e){return new Option(e,n)}))),e.image&&(n.images=ko.observableArray($.map(e.image,function(e){return new Image(e)}))),n.quantity=ko.observable(1),n.computed_price=ko.computed(function(){var e;return e=parseFloat(n.sizes()?n.sizeSelectedOptionValue().price():n.price()),_.each(n.options(),function(t){var n=parseFloat(t.computed_price());e+=n}),e*=n.quantity(),isNaN(e)?0..toFixed(2):parseFloat(e).toFixed(2)},n),n.title_image=ko.computed(function(){return n.images().length>0?n.images()[0].url():"/app/public/icon@2x.png"},n),n.large_title_image=ko.computed(function(){return n.images().length>0?n.images()[0].original():!1},n),n.lazyLoadImage=ko.computed(function(){return n.images().length>0?n.images()[0].original():""}),n.lazyLoadMediumImage=ko.computed(function(){return n.images().length>0?n.images()[0].medium():""}),n.addQuantity=function(){12!=n.quantity()&&n.quantity(n.quantity()+1)},n.subQuantity=function(){1!=n.quantity()&&n.quantity(n.quantity()-1)},n.editing=ko.observable(!1),n.edit=function(){console.log("Editing "+n.name()+"!"),n.editing(!0)},n.editing_name=ko.observable(!1),n.edit_name=function(){console.log("Editing_name!"),n.editing_name(!0)},n.templateToUse=function(e){return"size"==e.type?"size":"default"},n.addOption=function(){console.log("Adding option!"),n.options.push(new Option({name:copyDefaultHash(default_language_hash),type:"generic",placeholder:"Type the option group title here.",individual_options:[{placeholder:"Type the first option title here.",price:"0.0",name:copyDefaultHash(default_language_hash)},{placeholder:"Type the second option title here.",price:"0.0",name:copyDefaultHash(default_language_hash)}]},n))},n.addImage=function(e){var t=new Image(e);return n.images.unshift(t),t},n.removeImage=function(e){bootbox.dialog({message:localizeMessage(null,"remove_image"),title:"Remove Image",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){n.images.remove(e)}}}})},n.remove=function(e){bootbox.dialog({message:'Are you sure you want to remove the option titled "'+e.name()+'"?',title:"Remove Option",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){n.options.remove(e)}}}})},n.triggerImageSelect=function(e){$("#image_upload"+e).click()},n.computedWidth=ko.computed(function(){var e=0;return n.large_title_image()&&(e+=40),(n.sizes()||n.description()[lang()])&&(e+=40),e>0?e+"%":"400px"}),n.computedHeight=ko.computed(function(){return n.large_title_image()?"80%":"40%"}),n.modalImageWidth=ko.computed(function(){return n.sizes()||n.description()[lang()]?"dish_half":"dish_full"}),n.modalDescriptionWidth=ko.computed(function(){return n.large_title_image()?"dish_half":"dish_full"}),n.noContent=ko.computed(function(){return n.sizes()||n.description()[lang()]||n.large_title_image()?!1:!0})}function Option(e,t){var n=this;n.name=ko.observable(e.name),n.dish=t,n.advanced=ko.observable(!1),n.extra_cost=ko.observable(!1),n.placeholder=ko.observable("Type the option title here."),e.placeholder&&n.placeholder(e.placeholder),n.id=ko.observable(),e._id?(n.id(e._id),n.advanced(e.advanced),e.extra_cost&&n.extra_cost(e.extra_cost)):editing_mode&&$.ajax({type:"POST",url:"/app/menucrud/create_option",data:{restaurant_id:restaurant_id},success:function(e){console.log("Option Saved."),n.id(e.id)},error:function(e,t,n){console.log("There was an error saving the option "+n)},dataType:"json"}),n.type=e.type,n.max_selections=ko.observable(e.max_selections?e.max_selections:0),n.min_selections=ko.observable(e.min_selections?e.min_selections:0),n.multiple_prices=n.dish.sizes,"size"!=e.type&&(n.sizes_object_names=t.sizes_object().individual_options),n.individual_options=ko.observableArray([]),e.individual_options&&(n.individual_options=ko.observableArray($.map(e.individual_options,function(e){return new IndividualOption(e,n)}))),n.max_selection_list=ko.computed(function(){var e=[];return _.each(n.individual_options(),function(t,n){e.push(n+1)}),e}),n.min_selection_list=ko.computed(function(){var e=[];return _.each(n.individual_options(),function(t,n){e.push(n)}),e}),n.selectedOptionValue=ko.observableArray([]),n.maxSelectionsMet=ko.computed(function(){return n.selectedOptionValue().length>=n.max_selections()?!0:!1}),n.computed_price=ko.computed(function(){var e=0;return n.extra_cost()&&_.each(n.selectedOptionValue(),function(t){e+=parseFloat(t.computed_price())}),e}),n.option_title=ko.computed(function(){return"Add an option to "+n.dish.name()+"."}),n.editing_name=ko.observable(!1),n.edit_name=function(){n.editing_name(!0)},n.addSize=function(){n.individual_options.push(new IndividualOption({name:copyDefaultHash(default_language_hash),placeholder:"Type new size title here.",price:"0.0"},n))},n.addOption=function(){n.individual_options.push(new IndividualOption({name:copyDefaultHash(default_language_hash),placeholder:"Type new option title here.",price:"0.0"},n))},n.remove=function(e){bootbox.dialog({message:'Are you sure you want to remove the size option titled "'+e.name()+'"?',title:"Remove Size Option",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){e.remove_size_options(),n.individual_options.remove(e)}}}})},n.toggleAdvanced=function(){n.advanced(!n.advanced())}}function SizePrices(e){var t=this;t.name=e.name,t.ind_opt=e.ind_opt,t.size_ind_opt=e.size_ind_opt,t.size_ind_opt_id=e.size_ind_opt._id,t.price=ko.observable(e.price),t.e_price=ko.observable(!1),t.size_id=ko.observable(e.size_id),t.edit_price_size=function(){t.e_price(!0)},t.remove_self=function(){bootbox.dialog({message:'Are you sure you want to remove the suboption titled "'+item.name()+'"?',title:"Remove Suboption",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){t.ind_opt.remove_size_option(t)}}}})}}function IndividualOption(e,t){var n=this;n.id=ko.observable(),e._id?n.id(e._id):editing_mode&&$.ajax({type:"POST",url:"/app/menucrud/create_individual_option",data:{restaurant_id:restaurant_id},success:function(e){console.log("Individual Option Saved."),n.id(e.id)},error:function(e,t,n){console.log("There was an error saving the individual option "+n)},dataType:"json"}),n.option=t,n.name=ko.observable(e.name),n.price=ko.observable(e.price),n.type=t.type,n.dish=t.dish,n.destroy_it=!1,n.icon=ko.observable(),n.size_prices=ko.observableArray([]),n.price_according_to_size=ko.observable(!1),n.placeholder=ko.observable("Type the option here."),e.placeholder&&n.placeholder(e.placeholder),e.icon&&n.icon(new Image(e.icon)),e.price_according_to_size&&n.price_according_to_size(e.price_according_to_size),e.size_prices&&"size"!=n.type&&_.each(e.size_prices,function(e){var t=_.find(n.option.sizes_object_names(),function(t){return t.id()==e.size_id});if(t){var o=new SizePrices({name:t.name,size_id:t.id,price:e.price,ind_opt:n,size_ind_opt:t});n.size_prices.push(o)}}),n.size_prices_to_remove=new Array,"size"!=n.type&&(_.each(n.option.sizes_object_names(),function(e){void 0===_.find(n.size_prices(),function(t){return t.size_ind_opt==e})&&(n.new_size_prices=new SizePrices({name:e.name,size_id:e.id,price:0,ind_opt:n,size_ind_opt:e}),n.size_prices.push(n.new_size_prices),e.size_prices_to_remove.push(n.new_size_prices))}),n.option.sizes_object_names.subscribe(function(){_.each(n.option.sizes_object_names(),function(e){void 0===_.find(n.size_prices(),function(t){return t.size_ind_opt==e})&&(n.new_size_prices=new SizePrices({name:e.name,size_id:e.id,price:0,ind_opt:n,size_ind_opt:e}),n.size_prices.push(n.new_size_prices),e.size_prices_to_remove.push(n.new_size_prices))})},n),n.computed_price=ko.computed(function(){if(n.dish.sizes()){if(n.price_according_to_size()){var e=_.find(n.size_prices(),function(e){return e.name()==n.dish.sizeSelectedOptionValue().name()});return e.price()}return n.price()}return n.price()})),n.remove_size_option=function(e){n.size_prices.remove(e)},n.remove_size_options=function(){_.each(n.size_prices_to_remove,function(e){e.remove_self()})},n.editing_name=ko.observable(!1),n.edit_name=function(){n.editing_name(!0)},n.editing_price=ko.observable(!1),n.edit_price=function(){n.editing_price(!0)},n.addImage=function(e){var t=new Image(e);return n.icon(t),t},n.clickable=ko.computed({read:function(){return n.option.advanced()?!n.option.maxSelectionsMet()||n.option.selectedOptionValue().indexOf(n)>=0?!1:!0:!1},deferEvaluation:!0})}function MenuViewModel(){var e=this;e.menu=ko.observableArray([]),e.newDomCounter=0,e.preview=ko.observable(!1),e.restaurant=ko.observable(new Restaurant(resto_data)),e.languages=e.restaurant().languages,e.lang=ko.observable("en"),lang=e.lang;var t=!1;e.show_lang=ko.computed(function(){return e.languages().length>1?!0:!1}),e.togglePreview=function(){e.preview(!e.preview())},e.previewText=ko.computed(function(){return e.preview()?"Web Preview":"iPhone Preview"}),e.menu.subscribe(function(){_.each(e.menu(),function(e,t){console.log(e.name()),e.position(t)}),console.log("----------------")}),e.menu($.map(menu_data.menu,function(t){return new Section(t,e)})),$(".tooltipclass").tooltip({delay:{show:500,hide:100}}),e.current_dish=ko.observable(),e.current_section=ko.observable(),e.set_dish=function(t){e.current_section(null),e.current_dish(t),$("body").animate({scrollTop:0},"100","swing")},e.set_section=function(t){e.current_dish(null),e.current_section(t),$("body").animate({scrollTop:0},"100","swing")},e.current_dish_check=function(t){return t==e.current_dish()?!0:!1},e.current_section_check=function(t){return t==e.current_section()?!0:!1},e.newSectionName=ko.observable(),e.addSection=function(){console.log("Adding Section"),e.newDomCounter++;var t=new Section({name:copyDefaultHash(sectionNames),subsection:[],dom_id:e.newDomCounter},e);e.menu.push(t),e.current_section(t),e.current_dish(null)},e.showModal=function(e){console.log("#"+e.id()),$("#"+e.id()).modal("show")},e.publishMenu=function(){bootbox.dialog({message:"Are you sure you want to publish your changes to the menu? The changes will be immediately visible to the world.",title:"Publish Menu",buttons:{success:{label:"Cancel",className:"btn-default pull-left col-xs-5",callback:function(){}},danger:{label:"Publish",className:"btn-success col-xs-5 pull-right",callback:function(){var t=new Spinner(opts).spin(document.getElementById("center"));$("#loading").fadeIn(),$.ajax({type:"POST",url:"/app/administration/publish_menu",data:{restaurant_id:restaurant_id,menu:ko.toJSON(e.menu)},success:function(){t.stop(),$("#loading").fadeOut(),bootbox.alert("Menu Published!")},error:function(e,n,o){t.stop(),$("#loading").fadeOut(),bootbox.alert("There was an error publishing the menu.\n"+o)},dataType:"json"})}}}})},e.discardDraft=function(){bootbox.dialog({message:"Are you sure you want to discard all your changes? Everything will revert to your last save.",title:"Discard Draft",buttons:{success:{label:"Continue Editing",className:"btn-default pull-left col-xs-5",callback:function(){}},danger:{label:"Discard Draft",className:"btn-danger col-xs-5 pull-right",callback:function(){t=!0,location.reload()}}}})},e.for_real_discard=function(){$.ajax({type:"POST",url:"/app/administration/reset_draft_menu",data:{restaurant_id:restaurant_id,menu:ko.toJSON(e.menu)},success:function(){t=!0,window.location.href="/app"},error:function(e,t,n){bootbox.alert("There was an error publishing the menu.\n"+n)},dataType:"json"})},e.remove=function(t){bootbox.dialog({message:localizeMessage(t.name(),"delete_section"),title:"Remove Section",buttons:{success:{label:"No",className:"btn-default pull-left col-xs-3",callback:function(){}},danger:{label:"Yes",className:"btn-danger col-xs-3 pull-right",callback:function(){e.menu.remove(t),e.current_section(e.menu()[0])}}}})},e.save_menu_modal=ko.observable(!1),e.preview_token=ko.observable(""),e.saveDraft=function(){var n=new Spinner(opts).spin(document.getElementById("center"));$.ajax({type:"POST",url:"/app/administration/update_menu",data:{restaurant_id:restaurant_id,menu:ko.toJSON(e.menu)},success:function(o){n.stop(),e.preview_token(o.preview_token),e.save_menu_modal(!0),t=!0},error:function(e,t,o){console.log("There was an error saving the menu: "+o),n.stop()},dataType:"json"})},$(window).on("beforeunload",function(){return t?void 0:"Make sure you've saved your changes!"}),e.firstSectionHelp=ko.computed(function(){return 0==e.menu().length}),e.firstSectionNameHelp=ko.computed(function(){return 1==e.menu().length&&""==e.menu()[0].name().en&&e.current_section()}),e.firstDishHelp=ko.computed(function(){return 1==e.menu().length&&0==e.menu()[0].dishes().length&&""!=e.menu()[0].name().en}),e.firstDishPreviewHelp=ko.computed(function(){return 1==e.menu().length&&1==e.menu()[0].dishes().length})}function PublicMenuModel(){ko.menuVisible||(ko.menuVisible=ko.observable(!1)),ko.reloadMap||(ko.reloadMap=ko.observable(!1));var e=this;e.menu=ko.observableArray([]),e.newDomCounter=0,e.preview=ko.observable(!0),e.restaurant=ko.observable(new Restaurant(resto_data)),e.languages=e.restaurant().languages,e.lang=ko.observable(e.languages()[0]),lang=e.lang,e.selected_dish=ko.observable(),e.show_lang=ko.computed(function(){return e.languages().length>1?!0:!1}),e.languages_full={en:"English",fr:"Fran\xe7ais"},e.main_title_visible=ko.computed(function(){return $(window).width()<900?!0:!ko.menuVisible()}),e.set_dish=function(t){e.selected_dish(t)},e.getFullLangName=function(t){return ko.observable(e.languages_full[t])},e.display_menu=ko.observable(!1),e.display_menu_toggle=function(){e.display_menu(!e.display_menu())},e.goto_and_kill_menu=function(t){pager.goTo(t),e.display_menu(!1)},e.design=new Design(design_data),e.contact_tr=ko.observable({en:"Contact",fr:"Contact"}),e.menu_tr=ko.observable({en:"Menu",fr:"la Carte"}),e.about_tr=ko.observable({en:"About",fr:"Sur"});var t=!0;e.atTop=ko.observable(!1),$(window).width()>600&&(t=!1),t&&($(document).on("scrollstop",function(){console.log("scrollstop "+$("body").scrollTop()),e.atTop($("body").scrollTop()<=30?!1:!0)}),e.atTop($("body").scrollTop()<=30?!1:!0));var n,o=document.body;window.addEventListener("scroll",function(){clearTimeout(n),o.classList.contains("disable-hover")||o.classList.add("disable-hover"),n=setTimeout(function(){o.classList.remove("disable-hover")},500)},!1),e.showDetails=ko.observable(!1),e.toggleDetails=function(){e.showDetails(!e.showDetails())},e.menu($.map(menu_data.menu,function(t){return new Section(t,e)})),e.computeImage=function(t){return e.design.imgs[t]?"url("+e.design.imgs[t]()+")":""}}function DemoViewModel(){var e=this;e.dish=new Dish(dish_demo_json,e),e.showModal=function(e){$("#"+e.id()).modal("show")}}if(function(e){e.Jcrop=function(t,n){function o(e){return Math.round(e)+"px"}function i(e){return A.baseClass+"-"+e}function r(){return e.fx.step.hasOwnProperty("backgroundColor")}function a(t){var n=e(t).offset();return[n.left,n.top]}function s(e){return[e.pageX-N[0],e.pageY-N[1]]}function l(t){"object"!=typeof t&&(t={}),A=e.extend(A,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof A[t]&&(A[t]=function(){})})}function u(e,t,n){if(N=a(W),ht.setCursor("move"===e?e:e+"-resize"),"move"===e)return ht.activateHandlers(c(t),m,n);var o=ct.getFixed(),i=p(e),r=ct.getCorner(p(i));ct.setPressed(ct.getCorner(i)),ct.setCurrent(r),ht.activateHandlers(d(e,o),m,n)}function d(e,t){return function(n){if(A.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}ct.setCurrent(n),ft.update()}}function c(e){var t=e;return gt.watchKeys(),function(e){ct.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ft.update()}}function p(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";
case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function f(e){return function(t){return A.disabled?!1:"move"!==e||A.allowMove?(N=a(W),ot=!0,u(e,s(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function h(e,t,n){var o=e.width(),i=e.height();o>t&&t>0&&(o=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,o=n/e.height()*e.width()),tt=e.width()/o,nt=e.height()/i,e.width(o).height(i)}function g(e){return{x:e.x*tt,y:e.y*nt,x2:e.x2*tt,y2:e.y2*nt,w:e.w*tt,h:e.h*nt}}function m(){var e=ct.getFixed();e.w>A.minSelect[0]&&e.h>A.minSelect[1]?(ft.enableHandles(),ft.done()):ft.release(),ht.setCursor(A.allowSelect?"crosshair":"default")}function b(e){if(A.disabled)return!1;if(!A.allowSelect)return!1;ot=!0,N=a(W),ft.disableHandles(),ht.setCursor("crosshair");var t=s(e);return ct.setPressed(t),ft.update(),ht.activateHandlers(v,m,"touch"===e.type.substring(0,5)),gt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function v(e){ct.setCurrent(e),ft.update()}function y(){var t=e("<div></div>").addClass(i("tracker"));return M&&t.css({opacity:0,backgroundColor:"white"}),t}function _(e){F.removeClass().addClass(i("holder")).addClass(e)}function w(e,t){function n(){window.setTimeout(v,c)}var o=e[0]/tt,i=e[1]/nt,r=e[2]/tt,a=e[3]/nt;if(!it){var s=ct.flipCoords(o,i,r,a),l=ct.getFixed(),u=[l.x,l.y,l.x2,l.y2],d=u,c=A.animationDelay,p=s[0]-u[0],f=s[1]-u[1],h=s[2]-u[2],g=s[3]-u[3],m=0,b=A.swingSpeed;o=d[0],i=d[1],r=d[2],a=d[3],ft.animMode(!0);var v=function(){return function(){m+=(100-m)/b,d[0]=Math.round(o+m/100*p),d[1]=Math.round(i+m/100*f),d[2]=Math.round(r+m/100*h),d[3]=Math.round(a+m/100*g),m>=99.8&&(m=100),100>m?(x(d),n()):(ft.done(),ft.animMode(!1),"function"==typeof t&&t.call(mt))}}();n()}}function k(e){x([e[0]/tt,e[1]/nt,e[2]/tt,e[3]/nt]),A.onSelect.call(mt,g(ct.getFixed())),ft.enableHandles()}function x(e){ct.setPressed([e[0],e[1]]),ct.setCurrent([e[2],e[3]]),ft.update()}function S(){return g(ct.getFixed())}function z(){return ct.getFixed()}function O(e){l(e),E()}function T(){A.disabled=!0,ft.disableHandles(),ft.setCursor("default"),ht.setCursor("default")}function C(){A.disabled=!1,E()}function I(){ft.done(),ht.activateHandlers(null,null)}function j(){F.remove(),R.show(),R.css("visibility","visible"),e(t).removeData("Jcrop")}function D(e,t){ft.release(),T();var n=new Image;n.onload=function(){var o=n.width,i=n.height,r=A.boxWidth,a=A.boxHeight;W.width(o).height(i),W.attr("src",e),J.attr("src",e),h(W,r,a),G=W.width(),V=W.height(),J.width(G).height(V),st.width(G+2*at).height(V+2*at),F.width(G).height(V),pt.resize(G,V),C(),"function"==typeof t&&t.call(mt)},n.src=e}function B(e,t,n){var o=t||A.bgColor;A.bgFade&&r()&&A.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:A.fadeTime}):e.css("backgroundColor",o)}function E(e){A.allowResize?e?ft.enableOnly():ft.enableHandles():ft.disableHandles(),ht.setCursor(A.allowSelect?"crosshair":"default"),ft.setCursor(A.allowMove?"move":"default"),A.hasOwnProperty("trueSize")&&(tt=A.trueSize[0]/G,nt=A.trueSize[1]/V),A.hasOwnProperty("setSelect")&&(k(A.setSelect),ft.done(),delete A.setSelect),pt.refresh(),A.bgColor!=lt&&(B(A.shade?pt.getShades():F,A.shade?A.shadeColor||A.bgColor:A.bgColor),lt=A.bgColor),ut!=A.bgOpacity&&(ut=A.bgOpacity,A.shade?pt.refresh():ft.setBgOpacity(ut)),K=A.maxSize[0]||0,Z=A.maxSize[1]||0,X=A.minSize[0]||0,et=A.minSize[1]||0,A.hasOwnProperty("outerImage")&&(W.attr("src",A.outerImage),delete A.outerImage),ft.refresh()}var N,A=e.extend({},e.Jcrop.defaults),P=navigator.userAgent.toLowerCase(),M=/msie/.test(P),L=/msie [1-6]\./.test(P);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),l(n);var H={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},R=e(t),Q=!0;if("IMG"==t.tagName){if(0!=R[0].width&&0!=R[0].height)R.width(R[0].width),R.height(R[0].height);else{var $=new Image;$.src=R[0].src,R.width($.width),R.height($.height)}var W=R.clone().removeAttr("id").css(H).show();W.width(R.width()),W.height(R.height()),R.after(W).hide()}else W=R.css(H).show(),Q=!1,null===A.shade&&(A.shade=!0);h(W,A.boxWidth,A.boxHeight);var G=W.width(),V=W.height(),F=e("<div />").width(G).height(V).addClass(i("holder")).css({position:"relative",backgroundColor:A.bgColor}).insertAfter(R).append(W);A.addClass&&F.addClass(A.addClass);var J=e("<div />"),q=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Y=e("<div />").width("100%").height("100%").css("zIndex",320),U=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=ct.getFixed();A.onDblClick.call(mt,e)}).insertBefore(W).append(q,Y);Q&&(J=e("<img />").attr("src",W.attr("src")).css(H).width(G).height(V),q.append(J)),L&&U.css({overflowY:"hidden"});var K,Z,X,et,tt,nt,ot,it,rt,at=A.boundary,st=y().width(G+2*at).height(V+2*at).css({position:"absolute",top:o(-at),left:o(-at),zIndex:290}).mousedown(b),lt=A.bgColor,ut=A.bgOpacity;N=a(W);var dt=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var i=n[e];i="on"+i;var r=i in o;r||(o.setAttribute(i,"return;"),r="function"==typeof o[i]),t[n[e]]=r}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}function t(){return A.touchSupport===!0||A.touchSupport===!1?A.touchSupport:e()}return{createDragger:function(e){return function(t){return A.disabled?!1:"move"!==e||A.allowMove?(N=a(W),ot=!0,u(e,s(dt.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return b(dt.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),ct=function(){function e(e){e=a(e),h=p=e[0],g=f=e[1]}function t(e){e=a(e),d=e[0]-h,c=e[1]-g,h=e[0],g=e[1]}function n(){return[d,c]}function o(e){var t=e[0],n=e[1];0>p+t&&(t-=t+p),0>f+n&&(n-=n+f),g+n>V&&(n+=V-(g+n)),h+t>G&&(t+=G-(h+t)),p+=t,h+=t,f+=n,g+=n}function i(e){var t=r();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function r(){if(!A.aspectRatio)return l();var e,t,n,o,i=A.aspectRatio,r=A.minSize[0]/tt,a=A.maxSize[0]/tt,d=A.maxSize[1]/nt,c=h-p,m=g-f,b=Math.abs(c),v=Math.abs(m),y=b/v;return 0===a&&(a=10*G),0===d&&(d=10*V),i>y?(t=g,n=v*i,e=0>c?p-n:n+p,0>e?(e=0,o=Math.abs((e-p)/i),t=0>m?f-o:o+f):e>G&&(e=G,o=Math.abs((e-p)/i),t=0>m?f-o:o+f)):(e=h,o=b/i,t=0>m?f-o:f+o,0>t?(t=0,n=Math.abs((t-f)*i),e=0>c?p-n:n+p):t>V&&(t=V,n=Math.abs(t-f)*i,e=0>c?p-n:n+p)),e>p?(r>e-p?e=p+r:e-p>a&&(e=p+a),t=t>f?f+(e-p)/i:f-(e-p)/i):p>e&&(r>p-e?e=p-r:p-e>a&&(e=p-a),t=t>f?f+(p-e)/i:f-(p-e)/i),0>e?(p-=e,e=0):e>G&&(p-=e-G,e=G),0>t?(f-=t,t=0):t>V&&(f-=t-V,t=V),u(s(p,f,e,t))}function a(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>G&&(e[0]=G),e[1]>V&&(e[1]=V),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,o){var i=e,r=n,a=t,s=o;return e>n&&(i=n,r=e),t>o&&(a=o,s=t),[i,a,r,s]}function l(){var e,t=h-p,n=g-f;return K&&Math.abs(t)>K&&(h=t>0?p+K:p-K),Z&&Math.abs(n)>Z&&(g=n>0?f+Z:f-Z),et/nt&&Math.abs(n)<et/nt&&(g=n>0?f+et/nt:f-et/nt),X/tt&&Math.abs(t)<X/tt&&(h=t>0?p+X/tt:p-X/tt),0>p&&(h-=p,p-=p),0>f&&(g-=f,f-=f),0>h&&(p-=h,h-=h),0>g&&(f-=g,g-=g),h>G&&(e=h-G,p-=e,h-=e),g>V&&(e=g-V,f-=e,g-=e),p>G&&(e=p-V,g-=e,f-=e),f>V&&(e=f-V,g-=e,f-=e),u(s(p,f,h,g))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,c,p=0,f=0,h=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:o,getCorner:i,getFixed:r}}(),pt=function(){function t(e,t){h.left.css({height:o(t)}),h.right.css({height:o(t)})}function n(){return i(ct.getFixed())}function i(e){h.top.css({left:o(e.x),width:o(e.w),height:o(e.y)}),h.bottom.css({top:o(e.y2),left:o(e.x),width:o(e.w),height:o(V-e.y2)}),h.right.css({left:o(e.x2),width:o(G-e.x2)}),h.left.css({width:o(e.x)})}function r(){return e("<div />").css({position:"absolute",backgroundColor:A.shadeColor||A.bgColor}).appendTo(f)}function a(){p||(p=!0,f.insertBefore(W),n(),ft.setBgOpacity(1,0,1),J.hide(),s(A.shadeColor||A.bgColor,1),ft.isAwake()?u(A.bgOpacity,1):u(1,1))}function s(e,t){B(c(),e,t)}function l(){p&&(f.remove(),J.show(),p=!1,ft.isAwake()?ft.setBgOpacity(A.bgOpacity,1,1):(ft.setBgOpacity(1,1,1),ft.disableHandles()),B(F,0,1))}function u(e,t){p&&(A.bgFade&&!t?f.animate({opacity:1-e},{queue:!1,duration:A.fadeTime}):f.css({opacity:1-e}))}function d(){A.shade?a():l(),ft.isAwake()&&u(A.bgOpacity)}function c(){return f.children()}var p=!1,f=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),h={top:r(),left:r().height(V),right:r().height(V),bottom:r()};return{update:n,updateRaw:i,getShades:c,setBgColor:s,enable:a,disable:l,resize:t,refresh:d,opacity:u}}(),ft=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:A.borderOpacity}).addClass(i(t));return q.append(n),n}function n(t,n){var o=e("<div />").mousedown(f(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return dt.support&&o.bind("touchstart.jcrop",dt.createDragger(t)),Y.append(o),o}function r(e){var t=A.handleSize,o=n(e,T++).css({opacity:A.handleOpacity}).addClass(i("handle"));return t&&o.width(t).height(t),o}function a(e){return n(e,T++).addClass("jcrop-dragbar")}function s(e){var t;for(t=0;t<e.length;t++)j[e[t]]=a(e[t])}function l(e){var n,o;for(o=0;o<e.length;o++){switch(e[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}C[e[o]]=t(n)}}function u(e){var t;for(t=0;t<e.length;t++)I[e[t]]=r(e[t])}function d(e,t){A.shade||J.css({top:o(-t),left:o(-e)}),U.css({top:o(t),left:o(e)})}function c(e,t){U.width(Math.round(e)).height(Math.round(t))}function p(){var e=ct.getFixed();ct.setPressed([e.x,e.y]),ct.setCurrent([e.x2,e.y2]),h()}function h(e){return O?m(e):void 0}function m(e){var t=ct.getFixed();c(t.w,t.h),d(t.x,t.y),A.shade&&pt.updateRaw(t),O||v(),e?A.onSelect.call(mt,g(t)):A.onChange.call(mt,g(t))}function b(e,t,n){(O||t)&&(A.bgFade&&!n?W.animate({opacity:e},{queue:!1,duration:A.fadeTime}):W.css("opacity",e))}function v(){U.show(),A.shade?pt.opacity(ut):b(ut,!0),O=!0}function _(){x(),U.hide(),A.shade?pt.opacity(1):b(1),O=!1,A.onRelease.call(mt)}function w(){D&&Y.show()}function k(){return D=!0,A.allowResize?(Y.show(),!0):void 0}function x(){D=!1,Y.hide()}function S(e){e?(it=!0,x()):(it=!1,k())}function z(){S(!1),p()}var O,T=370,C={},I={},j={},D=!1;A.dragEdges&&e.isArray(A.createDragbars)&&s(A.createDragbars),e.isArray(A.createHandles)&&u(A.createHandles),A.drawBorders&&e.isArray(A.createBorders)&&l(A.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var B=y().mousedown(f("move")).css({cursor:"move",position:"absolute",zIndex:360});return dt.support&&B.bind("touchstart.jcrop",dt.createDragger("move")),q.append(B),x(),{updateVisible:h,update:m,release:_,refresh:p,isAwake:function(){return O},setCursor:function(e){B.css("cursor",e)},enableHandles:k,enableOnly:function(){D=!0},showHandles:w,disableHandles:x,animMode:S,setBgOpacity:b,done:z}}(),ht=function(){function t(t){st.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",l):p&&e(document).bind("mousemove.jcrop",o).bind("mouseup.jcrop",i)}function n(){st.css({zIndex:290}),e(document).unbind(".jcrop")}function o(e){return d(s(e)),!1}function i(e){return e.preventDefault(),e.stopPropagation(),ot&&(ot=!1,c(s(e)),ft.isAwake()&&A.onSelect.call(mt,g(ct.getFixed())),n(),d=function(){},c=function(){}),!1}function r(e,n,o){return ot=!0,d=e,c=n,t(o),!1}function a(e){return d(s(dt.cfilter(e))),!1}function l(e){return i(dt.cfilter(e))}function u(e){st.css("cursor",e)}var d=function(){},c=function(){},p=A.trackDocument;return p||st.mousemove(o).mouseup(i).mouseout(i),W.before(st),{activateHandlers:r,setCursor:u}}(),gt=function(){function t(){A.keySupport&&(r.show(),r.focus())}function n(){r.hide()}function o(e,t,n){A.allowMove&&(ct.moveOffset([t,n]),ft.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function i(e){if(e.ctrlKey||e.metaKey)return!0;rt=e.shiftKey?!0:!1;var t=rt?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:A.allowSelect&&ft.release();break;case 9:return!0}return!1}var r=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=e("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return A.keySupport&&(r.keydown(i).blur(n),L||!A.fixedSupport?(r.css({position:"absolute",left:"-20px"}),a.append(r).insertBefore(W)):r.insertBefore(W)),{watchKeys:t}}();dt.support&&st.bind("touchstart.jcrop",dt.newSelection),Y.hide(),E(!0);var mt={setImage:D,animateTo:w,setSelect:k,setOptions:O,tellSelect:S,tellScaled:z,setClass:_,disable:T,enable:C,cancel:I,release:ft.release,destroy:j,focus:gt.watchKeys,getBounds:function(){return[G*tt,V*nt]},getWidgetSize:function(){return[G,V]},getScaleFactor:function(){return[tt,nt]},getOptions:function(){return A},ui:{holder:F,selection:U}};return M&&F.bind("selectstart",function(){return!1}),R.data("Jcrop",mt),mt},e.fn.Jcrop=function(t,n){var o;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o)}):(e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o))}),this},e.Jcrop.Loader=function(t,n,o){function i(){a.complete?(r.unbind(".jcloader"),e.isFunction(n)&&n.call(a)):window.setTimeout(i,50)}var r=e(t),a=r[0];r.bind("load.jcloader",i).bind("error.jcloader",function(){r.unbind(".jcloader"),e.isFunction(o)&&o.call(a)}),a.complete&&e.isFunction(n)&&(r.unbind(".jcloader"),n.call(a))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),!jQuery.browser){jQuery.browser={},jQuery.browser.mozilla=!1,jQuery.browser.webkit=!1,jQuery.browser.opera=!1,jQuery.browser.safari=!1,jQuery.browser.chrome=!1,jQuery.browser.msie=!1;var nAgt=navigator.userAgent;jQuery.browser.ua=nAgt,jQuery.browser.name=navigator.appName,jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(-1!=(verOffset=nAgt.indexOf("Opera")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8));else if(-1!=(verOffset=nAgt.indexOf("MSIE")))jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=nAgt.substring(verOffset+5);else if(-1!=nAgt.indexOf("Trident")){jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer";var start=nAgt.indexOf("rv:")+3,end=start+4;jQuery.browser.fullVersion=nAgt.substring(start,end)}else-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName));-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10),isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10)),jQuery.browser.version=jQuery.browser.majorVersion}jQuery.fn.CSSAnimate=function(e,t,n,o,i){return this.each(function(){var r=jQuery(this);if(this.id=this.id||"CSSA_"+(new Date).getTime(),0!==r.length&&e){if("function"==typeof t&&(i=t,t=jQuery.fx.speeds._default),"function"==typeof n&&(i=n,n=0),"function"==typeof o&&(i=o,o="cubic-bezier(0.65,0.03,0.36,0.72)"),"string"==typeof t)for(var a in jQuery.fx.speeds){if(t==a){t=jQuery.fx.speeds[a];break}t=null}if(jQuery.support.transition){var s="",l="transitionEnd";jQuery.browser.webkit?(s="-webkit-",l="webkitTransitionEnd"):jQuery.browser.mozilla?(s="-moz-",l="transitionend"):jQuery.browser.opera?(s="-o-",l="otransitionend"):jQuery.browser.msie&&(s="-ms-",l="msTransitionEnd"),a=[];for(d in e){var u=d;"transform"===u&&(u=s+"transform",e[u]=e[d],delete e[d]),"filter"===u&&(u=s+"filter",e[u]=e[d],delete e[d]),"transform-origin"===u&&(u=s+"transform-origin",e[u]=e[d],delete e[d]),a.push(u)}var d=a.join(","),c=function(){r.off(l+"."+r.get(0).id),clearTimeout(r.get(0).timeout),r.css(s+"transition",""),"function"==typeof i&&(r.called=!0,i(r))},p={};$.extend(p,e),p[s+"transition-property"]=d,p[s+"transition-duration"]=t+"ms",p[s+"transition-delay"]=n+"ms",p[s+"transition-timing-function"]=o,p[s+"backface-visibility"]="hidden",setTimeout(function(){r.css(p),r.one(l+"."+r.get(0).id,c)},1),r.get(0).timeout=setTimeout(function(){r.called||!i?r.called=!1:(r.css(s+"transition",""),i(r))},t+n+100)}else{for(var d in e)"transform"===d&&delete e[d],"transform-origin"===d&&delete e[d],"auto"===e[d]&&delete e[d];i&&"string"!=typeof i||(i="linear"),r.animate(e,t,i)}}})},jQuery.support.transition=function(){var e=(document.body||document.documentElement).style;return void 0!==e.transition||void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.MsTransition||void 0!==e.OTransition}(),function(e){e.mbBgndGallery={name:"mb.bgndGallery",author:"Matteo Bicocchi",version:"1.8.7",defaults:{containment:"body",images:[],shuffle:!1,controls:null,effect:"fade",timer:4e3,effTimer:3e3,raster:!1,folderPath:!1,autoStart:!0,grayScale:!1,activateKeyboard:!0,preserveTop:!1,preserveWidth:!1,placeHolder:"",thumbs:{folderPath:"",placeholder:""},onStart:function(){},onChange:function(){},onPause:function(){},onPlay:function(){},onNext:function(){},onPrev:function(){}},clear:!1,buildGallery:function(t){var n={};e.extend(n,e.mbBgndGallery.defaults,t),n.galleryID=(new Date).getTime();var o=e(n.containment).get(0);o.opt=n,e.mbBgndGallery.el=o,o.opt.onStart&&o.opt.onStart(),o.opt.gallery=e("<div/>").attr({id:"bgndGallery_"+o.opt.galleryID}).addClass("mbBgndGallery");var i="body"==o.opt.containment?"fixed":"absolute";o.opt.gallery.css({position:i,top:0,left:0,"z-index":-10,width:"100%",height:"100%",overflow:"hidden",backfaceVisibility:"hidden",webkitBackfaceVisibility:"hidden",mozBackfaceVisibility:"hidden",msBackfaceVisibility:"hidden"});var r=o.opt.containment;if("body"!=r&&""!=e(r).text().trim()){var a=e("<div/>").css({position:"absolute",minHeight:"100%",minWidth:"100%",zIndex:3});e(r).wrapInner(a),"static"==e(r).css("position")&&e(r).css("position","relative")}if(n.raster){var s=e("<div/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"url("+n.raster+")",zIndex:1});n.gallery.append(s)}e(r).prepend(n.gallery),o.opt.folderPath&&0==o.opt.images.length&&(o.opt.images=jQuery.loadFromSystem(o.opt.folderPath)),o.opt.shuffle&&(o.opt.images=e.shuffle(o.opt.images));var l=o.opt.images.length,u=0;e.mbBgndGallery.preload(o.opt.images[0],o),o.opt.gallery.on("imageLoaded."+o.opt.galleryID,function(){return u++,u==l?void o.opt.gallery.off("imageLoaded."+o.opt.galleryID):void e.mbBgndGallery.preload(o.opt.images[u],o)}),o.opt.imageCounter=0,e.mbBgndGallery.changePhoto(o.opt.images[o.opt.imageCounter],o),n.autoStart||(o.opt.paused=!0,e(o.opt.gallery).trigger("paused")),o.opt.gallery.on("imageReady."+o.opt.galleryID,function(){o.opt.paused||(clearTimeout(o.opt.changing),e.mbBgndGallery.play(o))}),e(window).on("resize",function(){var t=e("img",o.opt.gallery);e.mbBgndGallery.checkSize(t,o)});var d=o.opt.controls;if(d){var c=e(o.opt.controls).find(".counter");c.html(o.opt.imageCounter+1+" / "+o.opt.images.length),e.mbBgndGallery.buildControls(d,o),e(o.opt.containment).on("paused",function(){e(o.opt.controls).find(".play").show(),e(o.opt.controls).find(".pause").hide()}),e(o.opt.containment).on("play",function(){e(o.opt.controls).find(".play").hide(),e(o.opt.controls).find(".pause").show()})}return e.mbBgndGallery.buildThumbs(o),e(o)},normalizeCss:function(t){var n=jQuery.extend(!0,{},t),o="",i="transitionEnd";e.browser.webkit?(o="-webkit-",i="webkitTransitionEnd"):e.browser.mozilla?(o="-moz-",i="transitionend"):e.browser.opera?(o="-o-",i="oTransitionEnd"):e.browser.msie&&(o="-ms-",i="msTransitionEnd");for(var r in n)"transform"===r&&(n[o+"transform"]=n[r],delete n[r]),"transform-origin"===r&&(n[o+"transform-origin"]=t[r],delete n[r]),"filter"===r&&(n[o+"filter"]=t[r],delete n[r]);return n},preload:function(t,n){if(e.mbBgndGallery.clear)return void n.opt.gallery.remove();e("<img/>").load(function(){n.opt.gallery.trigger("imageLoaded."+n.opt.galleryID)}).attr("src",t)},checkSize:function(t,n){return t&&!e.mbBgndGallery.changing?e.mbBgndGallery.clear?void n.opt.gallery.remove():t.each(function(){var t=e(this),o=t.attr("w"),i=t.attr("h"),r="body"==n.opt.containment?window:n.opt.containment,a=o/i,s=e(r).width()/e(r).height();a>=s?(t.css("height","100%"),t.css("width","auto")):(t.css("width","100%"),t.css("height","auto")),t.css("margin-left",(e(r).width()-t.width())/2),n.opt.preserveTop||t.css("margin-top",(e(r).height()-t.height())/2),n.opt.preserveWidth&&t.css({width:"100%",height:"auto",left:0,marginLeft:0})}):void 0},changePhoto:function(t,n){if(e.mbBgndGallery.clear)return void n.opt.gallery.remove();e.mbBgndGallery.buildThumbs(n),n.opt.thumbs.folderPath.trim().length>0&&n.opt.thumbs.placeholder.trim().length>0&&(e(".sel",e(n.opt.thumbs.placeholder)).removeClass("sel"),e("#mbBgImg_"+n.opt.imageCounter).addClass("sel")),e.mbBgndGallery.changing=!0,n.opt.onChange&&n.opt.onChange(n.opt,n.opt.imageCounter);var o=e("<img/>").hide().load(function(){var t=e(this),o=e("<div/>").css({position:"absolute",top:-5e3});o.append(t),e("body").append(o),t.attr("w",t.width()),t.attr("h",t.height()),o.remove(),n.opt.effect="object"==typeof n.opt.effect?n.opt.effect:e.mbBgndGallery.effects[n.opt.effect],e("img",n.opt.gallery).CSSAnimate(n.opt.effect.exit,n.opt.effTimer,0,n.opt.effect.exitTiming,function(e){e.length&&e.remove()}),t.css({position:"absolute"}),n.opt.gallery.append(t),e.mbBgndGallery.changing=!1,e.mbBgndGallery.checkSize(t,n);var i={top:0,left:0,opacity:1,transform:"scale(1) rotate(0deg)",filter:" blur(0)"};i=e.mbBgndGallery.normalizeCss(i),t.css(e.mbBgndGallery.normalizeCss(n.opt.effect.enter)).show().CSSAnimate(i,n.opt.effTimer,0,n.opt.effect.enterTiming,function(){n.opt.gallery.trigger("imageReady."+n.opt.galleryID)})}).attr("src",t);o.error(function(){var t=e(this);t.attr("src",n.opt.placeHolder)});var i=e(n.opt.controls).find(".counter");i.html(n.opt.imageCounter+1+" / "+n.opt.images.length)},play:function(t){clearTimeout(t.opt.changing);var n=e("img",t.opt.gallery).not(":last");return n.remove(),e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onPlay&&t.opt.onPlay(t.opt),t.opt.changing=setTimeout(function(){t.opt.paused||(t.opt.onNext&&t.opt.onNext(t.opt),t.opt.imageCounter>=t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],e(t.opt.containment).get(0)))},t.opt.paused?0:t.opt.timer),void t.opt.gallery.trigger("play"))},pause:function(t){return e.mbBgndGallery.clear?void t.opt.gallery.remove():(clearTimeout(t.opt.changing),t.opt.paused=!0,t.opt.gallery.trigger("paused"),void(t.opt.onPause&&t.opt.onPause(t.opt)))},next:function(t){return e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onNext&&t.opt.onNext(t.opt),e.mbBgndGallery.pause(t),t.opt.imageCounter==t.opt.images.length-1&&(t.opt.imageCounter=-1),t.opt.imageCounter++,e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t),void clearTimeout(t.opt.changing))},prev:function(t){return e.mbBgndGallery.clear?void t.opt.gallery.remove():(t.opt.onPrev&&t.opt.onPrev(t.opt),e.mbBgndGallery.pause(t),clearTimeout(t.opt.changing),0==t.opt.imageCounter&&(t.opt.imageCounter=t.opt.images.length),t.opt.imageCounter--,void e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t))},loader:{show:function(){},hide:function(){}},keyboard:function(t){e(document).on("keydown.bgndGallery",function(n){switch(n.keyCode){case 32:t.opt.paused?(e.mbBgndGallery.play(t),t.opt.paused=!1):(t.opt.paused=!0,e.mbBgndGallery.pause(t)),n.preventDefault();break;case 39:e.mbBgndGallery.next(t),n.preventDefault();break;case 37:e.mbBgndGallery.prev(t),n.preventDefault()}})},buildControls:function(t,n){var o=e(t).find(".pause"),i=e(t).find(".play"),r=e(t).find(".next"),a=e(t).find(".prev"),s=e(t).find(".fullscreen");(e.browser.msie||e.browser.opera||"ontouchstart"in window)&&s.remove(),n.opt.autoStart&&i.hide(),o.on("click",function(){e.mbBgndGallery.pause(n),e(this).hide(),i.show()}),i.on("click",function(){n.opt.paused&&(clearTimeout(n.opt.changing),e.mbBgndGallery.play(n),n.opt.paused=!1)}),r.on("click",function(){e.mbBgndGallery.next(n),o.hide(),i.show()}),a.on("click",function(){e.mbBgndGallery.prev(n),o.hide(),i.show()}),s.on("click",function(){e.mbBgndGallery.runFullscreen(n)}),n.opt.activateKeyboard&&e.mbBgndGallery.keyboard(n)},changeGallery:function(t,n){t.opt.gallery.fadeOut(),e.mbBgndGallery.pause(t),t.opt.images=n;var o=t.opt.images,i=o.length,r=0;e.mbBgndGallery.preload(o[0],t),t.opt.gallery.on("imageLoaded."+t.opt.galleryID,function(){return r++,r==i?(t.opt.gallery.off("imageLoaded."+t.opt.galleryID),t.opt.gallery.fadeIn(),e.mbBgndGallery.play(t),void(t.opt.paused=!1)):void e.mbBgndGallery.preload(o[r],t)}),t.opt.imageCounter=0,e.mbBgndGallery.buildThumbs(t)},changeEffect:function(t){e.mbBgndGallery.el.opt.effect=t},runFullscreen:function(t){function n(e,t){for(var n,o,i=["webkit","moz","ms","o",""],r=0;r<i.length&&!e[n];){if(n=t,""==i[r]&&(n=n.substr(0,1).toLowerCase()+n.substr(1)),n=i[r]+n,o=typeof e[n],"undefined"!=o)return i=[i[r]],"function"==o?e[n]():e[n];r++}}function o(e){n(e,"RequestFullScreen")}function i(){(n(document,"FullScreen")||n(document,"IsFullScreen"))&&n(document,"CancelFullScreen")}var r=jQuery.browser.mozilla?"mozfullscreenchange":jQuery.browser.webkit?"webkitfullscreenchange":"fullscreenchange";if(jQuery(document).off(r),jQuery(document).on(r,function(){var o=n(document,"IsFullScreen")||n(document,"FullScreen");if(!o){t.isFullscreen=!1,e(".fullScreen_controls").remove(),e(t.opt.containment).is("body")||e(t.opt.containment).css({width:t.width,height:t.height,top:t.top,left:t.left,position:t.position}),t.opt.gallery.css({background:"transparent"});var i=e("#bgndGallery_"+t.opt.galleryID+" img:first")}e.mbBgndGallery.checkSize(i,t)}),t.isFullscreen)i();else{t.isFullscreen=!0,e(t.opt.containment).is("body")||(t.width=e(t.opt.containment).css("width"),t.height=e(t.opt.containment).css("height"),t.top=e(t.opt.containment).css("top"),t.left=e(t.opt.containment).css("left"),t.position=e(t.opt.containment).css("position"));var a=e(t.opt.controls).clone(!0).addClass("fullScreen_controls").css({position:"absolute",zIndex:1e3,bottom:20,right:20});a.find(".fullscreen").html("exit"),t.opt.gallery.append(a).css({background:"#000"}),e(t.opt.containment).CSSAnimate({width:"100%",height:"100%",top:0,left:0,position:"absolute"}),o(t.opt.gallery.get(0))}},buildThumbs:function(t){function n(e){return e.split("/").pop()}if(0!=t.opt.thumbs.folderPath.trim().length||0!=t.opt.thumbs.placeholder.trim().length){var o=e(t.opt.thumbs.placeholder).children().length||0;if(o!=t.opt.images.length){e(t.opt.thumbs.placeholder).empty();for(var i=0;i<t.opt.images.length;i++){var r=t.opt.thumbs.folderPath+n(t.opt.images[i]),a=e("<img/>").attr({src:r,id:"mbBgImg_"+i}).click(function(){t.opt.imageCounter=e(this).attr("i")-1,e.mbBgndGallery.next(t),t.opt.paused=!0}).attr("i",i);e(t.opt.thumbs.placeholder).append(a)}t.opt.thumbs.folderPath.trim().length>0&&t.opt.thumbs.placeholder.trim().length>0&&(e(".sel",e(t.opt.thumbs.placeholder)).removeClass("sel"),e("#mbBgImg_"+t.opt.imageCounter).addClass("sel"))}}},addImages:function(){var t=this.get(0);for(var n in arguments)t.opt.images.push(arguments[n]);e.mbBgndGallery.buildThumbs(t)}},e.fn.addImages=e.mbBgndGallery.addImages,jQuery.loadFromSystem=function(t,n){if(t){n||(n=["jpg","jpeg","png"]);var o=[];return e.ajax({url:t,async:!1,success:function(i){var r=e(i),a=r.find("[href]");a.each(function(){for(var i in n)e(this).attr("href").indexOf(n[i])>=0&&o.push(t+e(this).attr("href")),o=e.unique(o)}),r.remove()}}),o}},e.shuffle=function(e){for(var t=e.slice(),n=t.length,o=n;o--;){var i=parseInt(Math.random()*n),r=t[o];t[o]=t[i],t[i]=r}return t}}(jQuery),$.mbBgndGallery.effects={fade:{enter:{left:0,opacity:0},exit:{left:0,opacity:0},enterTiming:"ease-in",exitTiming:"ease-in"},slideUp:{enter:{top:"100%",opacity:1},exit:{top:0,opacity:0},enterTiming:"ease-in",exitTiming:"ease-in"},slideDown:{enter:{top:"-100%",opacity:1},exit:{top:0,opacity:0},enterTiming:"ease-in",exitTiming:"ease-in"},slideLeft:{enter:{left:"100%",opacity:1},exit:{left:"-100%",opacity:0}},slideRight:{enter:{left:"-100%",opacity:1},exit:{left:"100%",opacity:0}},zoom:{enter:{transform:"scale("+(1+5*Math.random())+")",opacity:0},exit:{transform:"scale("+(1+5*Math.random())+")",opacity:0},enterTiming:"cubic-bezier(0.19, 1, 0.22, 1)",exitTiming:"cubic-bezier(0.19, 1, 0.22, 1)"},zoomBlur:{enter:{opacity:0,filter:"blur(30px)",transform:"scale(2)"},exit:{opacity:0,filter:"blur(30px)",transform:"scale(2)"},enterTiming:"cubic-bezier(0.19, 1, 0.22, 1)",exitTiming:"cubic-bezier(0.19, 1, 0.22, 1)"},blur:{enter:{opacity:0,filter:"blur(30px)"},exit:{opacity:0,filter:"blur(30px)"},enterTiming:"cubic-bezier(0.19, 1, 0.22, 1)",exitTiming:"cubic-bezier(0.19, 1, 0.22, 1)"}},!function(e){var t={init:function(t){var n=e.extend({hash:"",onSet:function(){},onRemove:function(){}},t);return n.hash?(e.hashchange||(e.hashchange={},e.hashchange.onSet={},e.hashchange.onRemove={},e.hashchange.prevHash="",e.hashchange.listener=function(){if(window.location.hash!==e.hashchange.prevHash){var t=e.hashchange.onRemove[e.hashchange.prevHash],n=e.hashchange.onSet[window.location.hash];t&&t(),n&&n(),e.hashchange.prevHash=window.location.hash}},this.bind("hashchange",e.hashchange.listener)),e.hashchange.onSet[n.hash]=n.onSet,e.hashchange.onRemove[n.hash]=n.onRemove,window.location.hash===n.hash&&window.location.hash!==e.hashchange.prevHash&&e.hashchange.listener(),this):this}};e.fn.hashchange=function(e){if("[object Array]"===Object.prototype.toString.call(e)){for(var n=e.length-1;n>=0;n--)t.init.apply(this,[e[n]]);return this}return t.init.apply(this,arguments)}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["knockout","jquery","jquery.ui.sortable"],e):e(window.ko,jQuery)}(function(e,t){var n="ko_sortItem",o="ko_sourceIndex",i="ko_sortList",r="ko_parentList",a="ko_dragItem",s=e.utils.unwrapObservable,l=e.utils.domData.get,u=e.utils.domData.set,d=function(t,o){e.utils.arrayForEach(t,function(e){1===e.nodeType&&(u(e,n,o),u(e,r,l(e.parentNode,i)))})},c=function(t,n){var o,i={},r=s(t())||{};return r.data?(i[n]=r.data,i.name=r.template):i[n]=t(),e.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(t){i[t]=r[t]||e.bindingHandlers.sortable[t]
}),"foreach"===n&&(i.afterRender?(o=i.afterRender,i.afterRender=function(e,t){d.call(t,e,t),o.call(t,e,t)}):i.afterRender=d),i},p=function(e,t){var n=s(t);if(n)for(var o=0;e>o;o++)n[o]&&s(n[o]._destroy)&&e++;return e};e.bindingHandlers.sortable={init:function(d,f,h,g,m){var b,v,y=t(d),_=s(f())||{},w=c(f,"foreach"),k={};y.contents().each(function(){this&&1!==this.nodeType&&d.removeChild(this)}),t.extend(!0,k,e.bindingHandlers.sortable),_.options&&k.options&&(e.utils.extend(k.options,_.options),delete _.options),e.utils.extend(k,_),k.connectClass&&(e.isObservable(k.allowDrop)||"function"==typeof k.allowDrop)?e.computed({read:function(){var t=s(k.allowDrop),n="function"==typeof t?t.call(this,w.foreach):t;e.utils.toggleDomNodeCssClass(d,k.connectClass,n)},disposeWhenNodeIsRemoved:d},this):e.utils.toggleDomNodeCssClass(d,k.connectClass,k.allowDrop),e.bindingHandlers.template.init(d,function(){return w},h,g,m),b=k.options.start,v=k.options.update;var x=setTimeout(function(){var c;y.sortable(e.utils.extend(k.options,{start:function(t,n){var i=n.item[0];u(i,o,e.utils.arrayIndexOf(n.item.parent().children(),i)),n.item.find("input:focus").change(),b&&b.apply(this,arguments)},receive:function(e,t){c=l(t.item[0],a),c&&(c.clone&&(c=c.clone()),k.dragged&&(c=k.dragged.call(this,c,e,t)||c))},update:function(a,s){var d,f,h,g,m,b=s.item[0],y=s.item.parent()[0],_=l(b,n)||c;if(c=null,_&&(this===y||t.contains(this,y))){if(d=l(b,r),h=l(b,o),f=l(b.parentNode,i),g=e.utils.arrayIndexOf(s.item.parent().children(),b),w.includeDestroyed||(h=p(h,d),g=p(g,f)),(k.beforeMove||k.afterMove)&&(m={item:_,sourceParent:d,sourceParentNode:d&&s.sender||b.parentNode,sourceIndex:h,targetParent:f,targetIndex:g,cancelDrop:!1}),k.beforeMove&&(k.beforeMove.call(this,m,a,s),m.cancelDrop))return void(m.sourceParent?t(m.sourceParent===m.targetParent?this:s.sender).sortable("cancel"):t(b).remove());g>=0&&(d&&(d.splice(h,1),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates()),f.splice(g,0,_)),u(b,n,null),s.item.remove(),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),k.afterMove&&k.afterMove.call(this,m,a,s)}v&&v.apply(this,arguments)},connectWith:k.connectClass?"."+k.connectClass:!1})),void 0!==k.isEnabled&&e.computed({read:function(){y.sortable(s(k.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:d})},0);return e.utils.domNodeDisposal.addDisposeCallback(d,function(){(y.data("ui-sortable")||y.data("sortable"))&&y.sortable("destroy"),clearTimeout(x)}),{controlsDescendantBindings:!0}},update:function(t,n,o,r,a){var s=c(n,"foreach");u(t,i,s.foreach),e.bindingHandlers.template.update(t,function(){return s},o,r,a)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(n,o,i,r,l){var d=s(o())||{},p=d.options||{},f=e.utils.extend({},e.bindingHandlers.draggable.options),h=c(o,"data"),g=d.connectClass||e.bindingHandlers.draggable.connectClass,m=void 0!==d.isEnabled?d.isEnabled:e.bindingHandlers.draggable.isEnabled;return d=d.data||d,u(n,a,d),e.utils.extend(f,p),f.connectToSortable=g?"."+g:!1,t(n).draggable(f),void 0!==m&&e.computed({read:function(){t(n).draggable(s(m)?"enable":"disable")},disposeWhenNodeIsRemoved:n}),e.bindingHandlers.template.init(n,function(){return h},i,r,l)},update:function(t,n,o,i,r){var a=c(n,"data");return e.bindingHandlers.template.update(t,function(){return a},o,i,r)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}}),!function(e){function t(){}function n(e){function n(t){t.prototype.option||(t.prototype.option=function(t){e.isPlainObject(t)&&(this.options=e.extend(!0,this.options,t))})}function i(t,n){e.fn[t]=function(i){if("string"==typeof i){for(var a=o.call(arguments,1),s=0,l=this.length;l>s;s++){var u=this[s],d=e.data(u,t);if(d)if(e.isFunction(d[i])&&"_"!==i.charAt(0)){var c=d[i].apply(d,a);if(void 0!==c)return c}else r("no such method '"+i+"' for "+t+" instance");else r("cannot call methods on "+t+" prior to initialization; attempted to call '"+i+"'")}return this}return this.each(function(){var o=e.data(this,t);o?(o.option(i),o._init()):(o=new n(this,i),e.data(this,t,o))})}}if(e){var r="undefined"==typeof console?t:function(e){console.error(e)};return e.bridget=function(e,t){n(t),i(e,t)},e.bridget}}var o=Array.prototype.slice;"function"==typeof define&&define.amd?define("jquery-bridget/jquery.bridget",["jquery"],n):n(e.jQuery)}(window),function(e){function t(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n=document.documentElement,o=function(){};n.addEventListener?o=function(e,t,n){e.addEventListener(t,n,!1)}:n.attachEvent&&(o=function(e,n,o){e[n+o]=o.handleEvent?function(){var n=t(e);o.handleEvent.call(o,n)}:function(){var n=t(e);o.call(e,n)},e.attachEvent("on"+n,e[n+o])});var i=function(){};n.removeEventListener?i=function(e,t,n){e.removeEventListener(t,n,!1)}:n.detachEvent&&(i=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(o){e[t+n]=void 0}});var r={bind:o,unbind:i};"function"==typeof define&&define.amd?define("eventie/eventie",r):"object"==typeof exports?module.exports=r:e.eventie=r}(this),function(e){function t(e){"function"==typeof e&&(t.isReady?e():r.push(e))}function n(e){var n="readystatechange"===e.type&&"complete"!==i.readyState;if(!t.isReady&&!n){t.isReady=!0;for(var o=0,a=r.length;a>o;o++){var s=r[o];s()}}}function o(o){return o.bind(i,"DOMContentLoaded",n),o.bind(i,"readystatechange",n),o.bind(e,"load",n),t}var i=e.document,r=[];t.isReady=!1,"function"==typeof define&&define.amd?(t.isReady="function"==typeof requirejs,define("doc-ready/doc-ready",["eventie/eventie"],o)):e.docReady=o(e.eventie)}(this),function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var o=e.prototype,i=this,r=i.EventEmitter;o.getListeners=function(e){var t,n,o=this._getEvents();if(e instanceof RegExp){t={};for(n in o)o.hasOwnProperty(n)&&e.test(n)&&(t[n]=o[n])}else t=o[e]||(o[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,n){var o,i=this.getListenersAsObject(e),r="object"==typeof n;for(o in i)i.hasOwnProperty(o)&&-1===t(i[o],n)&&i[o].push(r?n:{listener:n,once:!1});return this},o.on=n("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=n("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,n){var o,i,r=this.getListenersAsObject(e);for(i in r)r.hasOwnProperty(i)&&(o=t(r[i],n),-1!==o&&r[i].splice(o,1));return this},o.off=n("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var o,i,r=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(o=n.length;o--;)r.call(this,t,n[o]);else for(o in t)t.hasOwnProperty(o)&&(i=t[o])&&("function"==typeof i?r.call(this,o,i):a.call(this,o,i));return this},o.removeEvent=function(e){var t,n=typeof e,o=this._getEvents();if("string"===n)delete o[e];else if(e instanceof RegExp)for(t in o)o.hasOwnProperty(t)&&e.test(t)&&delete o[t];else delete this._events;return this},o.removeAllListeners=n("removeEvent"),o.emitEvent=function(e,t){var n,o,i,r,a=this.getListenersAsObject(e);for(i in a)if(a.hasOwnProperty(i))for(o=a[i].length;o--;)n=a[i][o],n.once===!0&&this.removeListener(e,n.listener),r=n.listener.apply(this,t||[]),r===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=n("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=r,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}.call(this),function(e){function t(e){if(e){if("string"==typeof o[e])return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var t,i=0,r=n.length;r>i;i++)if(t=n[i]+e,"string"==typeof o[t])return t}}var n="Webkit Moz ms Ms O".split(" "),o=document.documentElement.style;"function"==typeof define&&define.amd?define("get-style-property/get-style-property",[],function(){return t}):"object"==typeof exports?module.exports=t:e.getStyleProperty=t}(window),function(e){function t(e){var t=parseFloat(e),n=-1===e.indexOf("%")&&!isNaN(t);return n&&t}function n(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0,n=a.length;n>t;t++){var o=a[t];e[o]=0}return e}function o(e){function o(e){if("string"==typeof e&&(e=document.querySelector(e)),e&&"object"==typeof e&&e.nodeType){var o=r(e);if("none"===o.display)return n();var i={};i.width=e.offsetWidth,i.height=e.offsetHeight;for(var d=i.isBorderBox=!(!u||!o[u]||"border-box"!==o[u]),c=0,p=a.length;p>c;c++){var f=a[c],h=o[f];h=s(e,h);var g=parseFloat(h);i[f]=isNaN(g)?0:g}var m=i.paddingLeft+i.paddingRight,b=i.paddingTop+i.paddingBottom,v=i.marginLeft+i.marginRight,y=i.marginTop+i.marginBottom,_=i.borderLeftWidth+i.borderRightWidth,w=i.borderTopWidth+i.borderBottomWidth,k=d&&l,x=t(o.width);x!==!1&&(i.width=x+(k?0:m+_));var S=t(o.height);return S!==!1&&(i.height=S+(k?0:b+w)),i.innerWidth=i.width-(m+_),i.innerHeight=i.height-(b+w),i.outerWidth=i.width+v,i.outerHeight=i.height+y,i}}function s(e,t){if(i||-1===t.indexOf("%"))return t;var n=e.style,o=n.left,r=e.runtimeStyle,a=r&&r.left;return a&&(r.left=e.currentStyle.left),n.left=t,t=n.pixelLeft,n.left=o,a&&(r.left=a),t}var l,u=e("boxSizing");return function(){if(u){var e=document.createElement("div");e.style.width="200px",e.style.padding="1px 2px 3px 4px",e.style.borderStyle="solid",e.style.borderWidth="1px 2px 3px 4px",e.style[u]="border-box";var n=document.body||document.documentElement;n.appendChild(e);var o=r(e);l=200===t(o.width),n.removeChild(e)}}(),o}var i=e.getComputedStyle,r=i?function(e){return i(e,null)}:function(e){return e.currentStyle},a=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("get-size/get-size",["get-style-property/get-style-property"],o):"object"==typeof exports?module.exports=o(require("get-style-property")):e.getSize=o(e.getStyleProperty)}(window),function(e,t){function n(e,t){return e[s](t)}function o(e){if(!e.parentNode){var t=document.createDocumentFragment();t.appendChild(e)}}function i(e,t){o(e);for(var n=e.parentNode.querySelectorAll(t),i=0,r=n.length;r>i;i++)if(n[i]===e)return!0;return!1}function r(e,t){return o(e),n(e,t)}var a,s=function(){if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],n=0,o=e.length;o>n;n++){var i=e[n],r=i+"MatchesSelector";if(t[r])return r}}();if(s){var l=document.createElement("div"),u=n(l,"div");a=u?n:r}else a=i;"function"==typeof define&&define.amd?define("matches-selector/matches-selector",[],function(){return a}):window.matchesSelector=a}(this,Element.prototype),function(e){function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e){for(var t in e)return!1;return t=null,!0}function o(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function i(e,i,r){function s(e,t){e&&(this.element=e,this.layout=t,this.position={x:0,y:0},this._create())}var l=r("transition"),u=r("transform"),d=l&&u,c=!!r("perspective"),p={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}[l],f=["transform","transition","transitionDuration","transitionProperty"],h=function(){for(var e={},t=0,n=f.length;n>t;t++){var o=f[t],i=r(o);i&&i!==o&&(e[o]=i)}return e}();t(s.prototype,e.prototype),s.prototype._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},s.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},s.prototype.getSize=function(){this.size=i(this.element)},s.prototype.css=function(e){var t=this.element.style;for(var n in e){var o=h[n]||n;t[o]=e[n]}},s.prototype.getPosition=function(){var e=a(this.element),t=this.layout.options,n=t.isOriginLeft,o=t.isOriginTop,i=parseInt(e[n?"left":"right"],10),r=parseInt(e[o?"top":"bottom"],10);i=isNaN(i)?0:i,r=isNaN(r)?0:r;var s=this.layout.size;i-=n?s.paddingLeft:s.paddingRight,r-=o?s.paddingTop:s.paddingBottom,this.position.x=i,this.position.y=r},s.prototype.layoutPosition=function(){var e=this.layout.size,t=this.layout.options,n={};t.isOriginLeft?(n.left=this.position.x+e.paddingLeft+"px",n.right=""):(n.right=this.position.x+e.paddingRight+"px",n.left=""),t.isOriginTop?(n.top=this.position.y+e.paddingTop+"px",n.bottom=""):(n.bottom=this.position.y+e.paddingBottom+"px",n.top=""),this.css(n),this.emitEvent("layout",[this])};var g=c?function(e,t){return"translate3d("+e+"px, "+t+"px, 0)"}:function(e,t){return"translate("+e+"px, "+t+"px)"};s.prototype._transitionTo=function(e,t){this.getPosition();var n=this.position.x,o=this.position.y,i=parseInt(e,10),r=parseInt(t,10),a=i===this.position.x&&r===this.position.y;if(this.setPosition(e,t),a&&!this.isTransitioning)return void this.layoutPosition();var s=e-n,l=t-o,u={},d=this.layout.options;s=d.isOriginLeft?s:-s,l=d.isOriginTop?l:-l,u.transform=g(s,l),this.transition({to:u,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},s.prototype.goTo=function(e,t){this.setPosition(e,t),this.layoutPosition()},s.prototype.moveTo=d?s.prototype._transitionTo:s.prototype.goTo,s.prototype.setPosition=function(e,t){this.position.x=parseInt(e,10),this.position.y=parseInt(t,10)},s.prototype._nonTransition=function(e){this.css(e.to),e.isCleaning&&this._removeStyles(e.to);for(var t in e.onTransitionEnd)e.onTransitionEnd[t].call(this)},s.prototype._transition=function(e){if(!parseFloat(this.layout.options.transitionDuration))return void this._nonTransition(e);var t=this._transn;for(var n in e.onTransitionEnd)t.onEnd[n]=e.onTransitionEnd[n];for(n in e.to)t.ingProperties[n]=!0,e.isCleaning&&(t.clean[n]=!0);if(e.from){this.css(e.from);var o=this.element.offsetHeight;o=null}this.enableTransition(e.to),this.css(e.to),this.isTransitioning=!0};var m=u&&o(u)+",opacity";s.prototype.enableTransition=function(){this.isTransitioning||(this.css({transitionProperty:m,transitionDuration:this.layout.options.transitionDuration}),this.element.addEventListener(p,this,!1))},s.prototype.transition=s.prototype[l?"_transition":"_nonTransition"],s.prototype.onwebkitTransitionEnd=function(e){this.ontransitionend(e)},s.prototype.onotransitionend=function(e){this.ontransitionend(e)};var b={"-webkit-transform":"transform","-moz-transform":"transform","-o-transform":"transform"};s.prototype.ontransitionend=function(e){if(e.target===this.element){var t=this._transn,o=b[e.propertyName]||e.propertyName;if(delete t.ingProperties[o],n(t.ingProperties)&&this.disableTransition(),o in t.clean&&(this.element.style[e.propertyName]="",delete t.clean[o]),o in t.onEnd){var i=t.onEnd[o];i.call(this),delete t.onEnd[o]}this.emitEvent("transitionEnd",[this])}},s.prototype.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(p,this,!1),this.isTransitioning=!1},s.prototype._removeStyles=function(e){var t={};for(var n in e)t[n]="";this.css(t)};var v={transitionProperty:"",transitionDuration:""};return s.prototype.removeTransitionStyles=function(){this.css(v)},s.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.emitEvent("remove",[this])},s.prototype.remove=function(){if(!l||!parseFloat(this.layout.options.transitionDuration))return void this.removeElem();var e=this;this.on("transitionEnd",function(){return e.removeElem(),!0}),this.hide()},s.prototype.reveal=function(){delete this.isHidden,this.css({display:""});var e=this.layout.options;this.transition({from:e.hiddenStyle,to:e.visibleStyle,isCleaning:!0})},s.prototype.hide=function(){this.isHidden=!0,this.css({display:""});var e=this.layout.options;this.transition({from:e.visibleStyle,to:e.hiddenStyle,isCleaning:!0,onTransitionEnd:{opacity:function(){this.isHidden&&this.css({display:"none"})}}})},s.prototype.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},s}var r=e.getComputedStyle,a=r?function(e){return r(e,null)}:function(e){return e.currentStyle};"function"==typeof define&&define.amd?define("outlayer/item",["eventEmitter/EventEmitter","get-size/get-size","get-style-property/get-style-property"],i):(e.Outlayer={},e.Outlayer.Item=i(e.EventEmitter,e.getSize,e.getStyleProperty))}(window),function(e){function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e){return"[object Array]"===c.call(e)}function o(e){var t=[];if(n(e))t=e;else if(e&&"number"==typeof e.length)for(var o=0,i=e.length;i>o;o++)t.push(e[o]);else t.push(e);return t}function i(e,t){var n=f(t,e);-1!==n&&t.splice(n,1)}function r(e){return e.replace(/(.)([A-Z])/g,function(e,t,n){return t+"-"+n}).toLowerCase()}function a(n,a,c,f,h,g){function m(e,n){if("string"==typeof e&&(e=s.querySelector(e)),!e||!p(e))return void(l&&l.error("Bad "+this.constructor.namespace+" element: "+e));this.element=e,this.options=t({},this.constructor.defaults),this.option(n);var o=++b;this.element.outlayerGUID=o,v[o]=this,this._create(),this.options.isInitLayout&&this.layout()}var b=0,v={};return m.namespace="outlayer",m.Item=g,m.defaults={containerStyle:{position:"relative"},isInitLayout:!0,isOriginLeft:!0,isOriginTop:!0,isResizeBound:!0,isResizingContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},t(m.prototype,c.prototype),m.prototype.option=function(e){t(this.options,e)},m.prototype._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),t(this.element.style,this.options.containerStyle),this.options.isResizeBound&&this.bindResize()},m.prototype.reloadItems=function(){this.items=this._itemize(this.element.children)},m.prototype._itemize=function(e){for(var t=this._filterFindItemElements(e),n=this.constructor.Item,o=[],i=0,r=t.length;r>i;i++){var a=t[i],s=new n(a,this);o.push(s)}return o},m.prototype._filterFindItemElements=function(e){e=o(e);for(var t=this.options.itemSelector,n=[],i=0,r=e.length;r>i;i++){var a=e[i];if(p(a))if(t){h(a,t)&&n.push(a);for(var s=a.querySelectorAll(t),l=0,u=s.length;u>l;l++)n.push(s[l])}else n.push(a)}return n},m.prototype.getItemElements=function(){for(var e=[],t=0,n=this.items.length;n>t;t++)e.push(this.items[t].element);return e},m.prototype.layout=function(){this._resetLayout(),this._manageStamps();var e=void 0!==this.options.isLayoutInstant?this.options.isLayoutInstant:!this._isLayoutInited;this.layoutItems(this.items,e),this._isLayoutInited=!0},m.prototype._init=m.prototype.layout,m.prototype._resetLayout=function(){this.getSize()},m.prototype.getSize=function(){this.size=f(this.element)},m.prototype._getMeasurement=function(e,t){var n,o=this.options[e];o?("string"==typeof o?n=this.element.querySelector(o):p(o)&&(n=o),this[e]=n?f(n)[t]:o):this[e]=0},m.prototype.layoutItems=function(e,t){e=this._getItemsForLayout(e),this._layoutItems(e,t),this._postLayout()},m.prototype._getItemsForLayout=function(e){for(var t=[],n=0,o=e.length;o>n;n++){var i=e[n];i.isIgnored||t.push(i)}return t},m.prototype._layoutItems=function(e,t){function n(){o.emitEvent("layoutComplete",[o,e])}var o=this;if(!e||!e.length)return void n();this._itemsOn(e,"layout",n);for(var i=[],r=0,a=e.length;a>r;r++){var s=e[r],l=this._getItemLayoutPosition(s);l.item=s,l.isInstant=t||s.isLayoutInstant,i.push(l)}this._processLayoutQueue(i)},m.prototype._getItemLayoutPosition=function(){return{x:0,y:0}},m.prototype._processLayoutQueue=function(e){for(var t=0,n=e.length;n>t;t++){var o=e[t];this._positionItem(o.item,o.x,o.y,o.isInstant)}},m.prototype._positionItem=function(e,t,n,o){o?e.goTo(t,n):e.moveTo(t,n)},m.prototype._postLayout=function(){this.resizeContainer()},m.prototype.resizeContainer=function(){if(this.options.isResizingContainer){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},m.prototype._getContainerSize=d,m.prototype._setContainerMeasure=function(e,t){if(void 0!==e){var n=this.size;n.isBorderBox&&(e+=t?n.paddingLeft+n.paddingRight+n.borderLeftWidth+n.borderRightWidth:n.paddingBottom+n.paddingTop+n.borderTopWidth+n.borderBottomWidth),e=Math.max(e,0),this.element.style[t?"width":"height"]=e+"px"}},m.prototype._itemsOn=function(e,t,n){function o(){return i++,i===r&&n.call(a),!0}for(var i=0,r=e.length,a=this,s=0,l=e.length;l>s;s++){var u=e[s];u.on(t,o)}},m.prototype.ignore=function(e){var t=this.getItem(e);t&&(t.isIgnored=!0)},m.prototype.unignore=function(e){var t=this.getItem(e);t&&delete t.isIgnored},m.prototype.stamp=function(e){if(e=this._find(e)){this.stamps=this.stamps.concat(e);for(var t=0,n=e.length;n>t;t++){var o=e[t];this.ignore(o)}}},m.prototype.unstamp=function(e){if(e=this._find(e))for(var t=0,n=e.length;n>t;t++){var o=e[t];i(o,this.stamps),this.unignore(o)}},m.prototype._find=function(e){return e?("string"==typeof e&&(e=this.element.querySelectorAll(e)),e=o(e)):void 0},m.prototype._manageStamps=function(){if(this.stamps&&this.stamps.length){this._getBoundingRect();for(var e=0,t=this.stamps.length;t>e;e++){var n=this.stamps[e];this._manageStamp(n)}}},m.prototype._getBoundingRect=function(){var e=this.element.getBoundingClientRect(),t=this.size;this._boundingRect={left:e.left+t.paddingLeft+t.borderLeftWidth,top:e.top+t.paddingTop+t.borderTopWidth,right:e.right-(t.paddingRight+t.borderRightWidth),bottom:e.bottom-(t.paddingBottom+t.borderBottomWidth)}},m.prototype._manageStamp=d,m.prototype._getElementOffset=function(e){var t=e.getBoundingClientRect(),n=this._boundingRect,o=f(e),i={left:t.left-n.left-o.marginLeft,top:t.top-n.top-o.marginTop,right:n.right-t.right-o.marginRight,bottom:n.bottom-t.bottom-o.marginBottom};return i},m.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},m.prototype.bindResize=function(){this.isResizeBound||(n.bind(e,"resize",this),this.isResizeBound=!0)},m.prototype.unbindResize=function(){this.isResizeBound&&n.unbind(e,"resize",this),this.isResizeBound=!1},m.prototype.onresize=function(){function e(){t.resize(),delete t.resizeTimeout}this.resizeTimeout&&clearTimeout(this.resizeTimeout);var t=this;this.resizeTimeout=setTimeout(e,100)},m.prototype.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},m.prototype.needsResizeLayout=function(){var e=f(this.element),t=this.size&&e;return t&&e.innerWidth!==this.size.innerWidth},m.prototype.addItems=function(e){var t=this._itemize(e);return t.length&&(this.items=this.items.concat(t)),t},m.prototype.appended=function(e){var t=this.addItems(e);t.length&&(this.layoutItems(t,!0),this.reveal(t))},m.prototype.prepended=function(e){var t=this._itemize(e);if(t.length){var n=this.items.slice(0);this.items=t.concat(n),this._resetLayout(),this._manageStamps(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(n)}},m.prototype.reveal=function(e){var t=e&&e.length;if(t)for(var n=0;t>n;n++){var o=e[n];o.reveal()}},m.prototype.hide=function(e){var t=e&&e.length;if(t)for(var n=0;t>n;n++){var o=e[n];o.hide()}},m.prototype.getItem=function(e){for(var t=0,n=this.items.length;n>t;t++){var o=this.items[t];if(o.element===e)return o}},m.prototype.getItems=function(e){if(e&&e.length){for(var t=[],n=0,o=e.length;o>n;n++){var i=e[n],r=this.getItem(i);r&&t.push(r)}return t}},m.prototype.remove=function(e){e=o(e);var t=this.getItems(e);if(t&&t.length){this._itemsOn(t,"remove",function(){this.emitEvent("removeComplete",[this,t])});for(var n=0,r=t.length;r>n;n++){var a=t[n];a.remove(),i(a,this.items)}}},m.prototype.destroy=function(){var e=this.element.style;e.height="",e.position="",e.width="";for(var t=0,n=this.items.length;n>t;t++){var o=this.items[t];o.destroy()}this.unbindResize(),delete this.element.outlayerGUID,u&&u.removeData(this.element,this.constructor.namespace)},m.data=function(e){var t=e&&e.outlayerGUID;return t&&v[t]},m.create=function(e,n){function o(){m.apply(this,arguments)}return Object.create?o.prototype=Object.create(m.prototype):t(o.prototype,m.prototype),o.prototype.constructor=o,o.defaults=t({},m.defaults),t(o.defaults,n),o.prototype.settings={},o.namespace=e,o.data=m.data,o.Item=function(){g.apply(this,arguments)},o.Item.prototype=new g,a(function(){for(var t=r(e),n=s.querySelectorAll(".js-"+t),i="data-"+t+"-options",a=0,d=n.length;d>a;a++){var c,p=n[a],f=p.getAttribute(i);try{c=f&&JSON.parse(f)}catch(h){l&&l.error("Error parsing "+i+" on "+p.nodeName.toLowerCase()+(p.id?"#"+p.id:"")+": "+h);continue}var g=new o(p,c);u&&u.data(p,e,g)}}),u&&u.bridget&&u.bridget(e,o),o},m.Item=g,m}var s=e.document,l=e.console,u=e.jQuery,d=function(){},c=Object.prototype.toString,p="object"==typeof HTMLElement?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},f=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1};"function"==typeof define&&define.amd?define("outlayer/outlayer",["eventie/eventie","doc-ready/doc-ready","eventEmitter/EventEmitter","get-size/get-size","matches-selector/matches-selector","./item"],a):e.Outlayer=a(e.eventie,e.docReady,e.EventEmitter,e.getSize,e.matchesSelector,e.Outlayer.Item)}(window),function(e){function t(e,t){var o=e.create("masonry");return o.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns();var e=this.cols;for(this.colYs=[];e--;)this.colYs.push(0);this.maxY=0},o.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var e=this.items[0],n=e&&e.element;this.columnWidth=n&&t(n).outerWidth||this.containerWidth}this.columnWidth+=this.gutter,this.cols=Math.floor((this.containerWidth+this.gutter)/this.columnWidth),this.cols=Math.max(this.cols,1)},o.prototype.getContainerWidth=function(){var e=this.options.isFitWidth?this.element.parentNode:this.element,n=t(e);this.containerWidth=n&&n.innerWidth},o.prototype._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth%this.columnWidth,o=t&&1>t?"round":"ceil",i=Math[o](e.size.outerWidth/this.columnWidth);i=Math.min(i,this.cols);for(var r=this._getColGroup(i),a=Math.min.apply(Math,r),s=n(r,a),l={x:this.columnWidth*s,y:a},u=a+e.size.outerHeight,d=this.cols+1-r.length,c=0;d>c;c++)this.colYs[s+c]=u;return l},o.prototype._getColGroup=function(e){if(2>e)return this.colYs;for(var t=[],n=this.cols+1-e,o=0;n>o;o++){var i=this.colYs.slice(o,o+e);t[o]=Math.max.apply(Math,i)}return t},o.prototype._manageStamp=function(e){var n=t(e),o=this._getElementOffset(e),i=this.options.isOriginLeft?o.left:o.right,r=i+n.outerWidth,a=Math.floor(i/this.columnWidth);a=Math.max(0,a);var s=Math.floor(r/this.columnWidth);s-=r%this.columnWidth?0:1,s=Math.min(this.cols-1,s);for(var l=(this.options.isOriginTop?o.top:o.bottom)+n.outerHeight,u=a;s>=u;u++)this.colYs[u]=Math.max(l,this.colYs[u])},o.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var e={height:this.maxY};return this.options.isFitWidth&&(e.width=this._getContainerFitWidth()),e},o.prototype._getContainerFitWidth=function(){for(var e=0,t=this.cols;--t&&0===this.colYs[t];)e++;return(this.cols-e)*this.columnWidth-this.gutter},o.prototype.needsResizeLayout=function(){var e=this.containerWidth;return this.getContainerWidth(),e!==this.containerWidth},o}var n=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,o=e.length;o>n;n++){var i=e[n];if(i===t)return n}return-1};"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],t):e.Masonry=t(e.Outlayer,e.getSize)}(window),GlobalImage.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.parent,e},ko.bindingHandlers.file_upload_global={update:function(e,t,n,o){$(e).fileupload({dropZone:$(e),formData:{carousel:o.carousel(),design_id:o.design_id(),name:o.name(),parent_id:o.parent_id(),data:ko.toJSON(o)},url:"/app/design/upload_image",dataType:"json",progressInterval:50,submit:function(e,t){console.log(t)},send:function(){o.fresh(!1)},done:function(e,t){var n=t.result.files[0];o.carousel()?o.parent.addCarousel():o.parent.addImage(),o.update_info(n)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);o.progressValue(n)},fail:function(){o.failed(!0)}})}},ko.bindingHandlers.file_upload_logo={update:function(e,t,n,o){o.imageModel,$(e).fileupload({dropZone:$(e),formData:{data:ko.toJSON(o),restaurant_id:restaurant_id,name:o.name(),id:o.id()},url:"/app/website/upload_logo",dataType:"json",progressInterval:50,send:function(){o.fresh(!1)},done:function(e,t){var n=t.result.files[0];o.update_info(n),o.carousel()&&o.parent.addCarousel()},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);o.progressValue(n)},fail:function(){o.failed(!0)}})}},ko.bindingHandlers.file_upload_global_customize={update:function(e,t,n,o){o.imageModel,$(e).fileupload({dropZone:$(e),formData:{data:ko.toJSON(o),design_id:o.design_id(),restaurant_id:restaurant_id,name:o.name(),id:o.id()},url:"/app/website/upload_image",dataType:"json",progressInterval:50,send:function(){o.fresh(!1)},done:function(e,t){var n=t.result.files[0];o.update_info(n),o.carousel()&&o.parent.addCarousel()},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);o.progressValue(n)},fail:function(){o.failed(!0)}})}},Day.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.times,delete e.buttonText,e},Restaurant.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.areWeOpened,delete e.areWeOpenedText,delete e.socialVisible,e},ko.bindingHandlers.fixSubdomain={update:function(e,t,n,o){var i=ko.utils.unwrapObservable(t());o.subdomain(i.replace(/[^0-9a-zA-Z]/g,""))}},ko.bindingHandlers.slider={init:function(e,t){var n=t(),o=n[1],i=n[2];n=n[0],$(e).slider({slide:function(e,t){n(t.value)},max:i,min:o,step:1,value:n()})}},ko.bindingHandlers.colorpicker={init:function(e,t){var n=t();$(e).colpick({colorScheme:"dark",layout:"hex",color:n(),onSubmit:function(e,t,o,i){$(i).css("background-color","#"+t),n(t),$(i).colpickHide()},onChange:function(e,t,o,i){$(i).css("background-color","#"+t),n(t)}}),$(e).css("background-color","#"+n())}},ko.bindingHandlers.fitText={update:function(e){var t=function(){$(e).parent().textfill({maxFontPixels:36})};$(window).on("resize orientationchange",t),t()}},ko.bindingHandlers.helperTip={init:function(e,t){var n=t();if($("#"+n.template)[0]){var o=document.createElement("div");return document.body.appendChild(o),o.innerHTML=$("#"+n.template).text(),o=$(o).find("div")[0],n.when.helperFitter=ko.computed(function(){if(n.when())if("bottom"==n.position){var t=document.body.getBoundingClientRect(),i=e.getBoundingClientRect(),r=i.bottom+10,a=i.right-$(e).width()/2;$(o).css("top",r+"px"),$(o).css("left",a+"px")}else{var t=document.body.getBoundingClientRect(),i=e.getBoundingClientRect(),r=i.top-t.top+$(e).height()/2,a=i.right+10;r-=$(o).height()/2,$(o).css("top",r+"px"),$(o).css("left",a+"px")}}),ko.applyBindingsToNode(o,{visible:n.when}),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){$(o).remove()}),{controlsDescendantBindings:!0}}}};var opts={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e5,top:"auto",left:"auto"};Section.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.topmodel,e},ko.bindingHandlers.file_upload={update:function(e,t,n,o){o.imageModel,$(e).fileupload({dropZone:$(e),formData:{restaurant_id:restaurant_id},url:image_upload_url,dataType:"json",progressInterval:50,send:function(e,t){$.each(t.files,function(e,t){o.imageModel=o.addImage(),o.imageModel.filename(t.name)})},done:function(e,t){var n=t.result.files[0];o.imageModel.update_info(n)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);
o.imageModel.progressValue(n)},fail:function(){o.imageModel.failed(!0)}})}},ko.bindingHandlers.file_upload_icon={update:function(e,t,n,o){o.imageModel,$(e).fileupload({dropZone:$(e),formData:{restaurant_id:restaurant_id},url:icon_upload_url,dataType:"json",progressInterval:50,send:function(e,t){$.each(t.files,function(e,t){o.imageModel=o.addImage(),o.imageModel.filename(t.name)})},done:function(e,t){var n=t.result.files[0];o.imageModel.update_info(n)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);o.imageModel.progressValue(n)},fail:function(){o.imageModel.failed(!0)}})}},Dish.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.topmodel,e},ko.bindingHandlers.modalResize={update:function(e,t){var n=t()();if(n){e=$(e);var o=e.find(".dish_modal_body"),i=o.height();75>i&&(i=75),i>100&&console.log("Big"),e.css("min-height",i+"px")}}},ko.bindingHandlers.menuImage={update:function(e,t){void 0===ko.menuVisible&&(ko.menuVisible=ko.observable(!1));var n=t();ko.menuVisible()?e.setAttribute("src",n()):e.setAttribute("src","")}},ko.bindingHandlers.modalImage={update:function(e,t,n,o){t();o.modalVisible()?e.setAttribute("src",t()()):e.setAttribute("src","")}},Option.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.dish,delete e.multiple_prices,delete e.sizes_object_names,e},SizePrices.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.ind_opt,delete e.size_ind_opt,e},IndividualOption.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.option,delete e.dish,delete e.type,delete e.size_prices_to_remove,e};var editing_mode=!0,lang;ko.bindingHandlers.fadeVisible={init:function(e,t){var n=t();$(e).toggle(ko.unwrap(n))},update:function(e,t){var n=t();ko.unwrap(n)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.masonry={update:function(e,t){var n=t(),o=n[1].replace(/[^a-z]/g,"");n=n[0](),n&&$(e).width()>768&&($(e).find(".image_section").addClass(o),o="."+o,$(e).masonry({columnWidth:o,itemSelector:o}))}};var translations={Hours:{en:"Hours",fr:"Heures"},Address:{en:"Address",fr:"Adresse"},Opens:{en:"Opens",fr:"Ouvrir"},Closes:{en:"Closes",fr:"Fermer"},closed:{en:"Closed",fr:"Fermer"},open:{en:"Open",fr:"Ouvert"},currently:{en:"Currently",fr:"Presentement"}};ko.bindingHandlers.jcrop={update:function(e,t,n,o){var i=t(),r=ko.unwrap(i),a=function(e){o.coordinates=[e.x,e.y,e.w,e.h]};$(e).attr("src",r.src()),$(e).css({width:r.width(),height:r.height()}),JcropAPI=$(e).data("Jcrop"),void 0!=JcropAPI&&JcropAPI.destroy(),$(e).Jcrop({boxWidth:450,bgColor:"black",bgOpacity:.4,setSelect:[100,100,50,50],onChange:a,onSelect:a})}},ko.bindingHandlers.lValue={init:function(e,t){var n,o=t(),i=ko.computed({read:function(){return o()[viewmodel.lang()]},write:function(e){var t=o();t[viewmodel.lang()]=e,o(t)}}),r=ko.computed(function(){return null==n&&(n=$(e).attr("placeholder")),"en"!=viewmodel.lang()?fullLanguageName[viewmodel.lang()]+" translation for '"+o().en+"'":n});ko.applyBindingsToNode(e,{value:i,valueUpdate:"afterkeydown"}),ko.applyBindingsToNode(e,{attr:{placeholder:r}})}},ko.bindingHandlers.price={init:function(e,t){var n=t(),o=ko.computed({read:function(){return n()},write:function(e){var t=n();t=e.replace(/[^0-9\.]/g,""),t=t.replace(/([0-9]*\.[0-9]*).*/,function(e,t){return t}),n(t),n.notifySubscribers()}}).extend({notify:"always"});ko.applyBindingsToNode(e,{value:o,valueUpdate:"afterkeydown"})}},ko.bindingHandlers.lText={update:function(e,t){var n=t(),o=ko.observable(n()[viewmodel.lang()]);ko.bindingHandlers.text.update(e,o)}},ko.bindingHandlers.lStaticText={init:function(e,t){var n=t();"function"==typeof n&&(n=n());var o=ko.computed({read:function(){return translations[n]?translations[n][viewmodel.lang()]:(console.log("WARNING: Missing translation for '"+n+"'"),n)},deferEvaluation:!0});ko.applyBindingsToNode(e,{text:o})}},ko.bindingHandlers.lHtml={update:function(e,t){var n=t(),o=ko.observable(n()[viewmodel.lang()]);ko.utils.setHtml(e,o)}},ko.virtualElements.allowedBindings.lText=!0;